#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <stdint.h>
#include<string.h>
#include <time.h>


#define INPUT_DIMENSION 10
#define scale 88.0
#define NUM_FEATURES 10
#define nl printf("\n")

static void filter(const double b[5], const double a[5], const double x[174], const double zi[4], double y[174]);
static void filtfilt(const double x_in[150], double y_out[150]);


// ###################################################################################
double relu(double x)
{
  return x > 0 ? x : 0;
}

double sigmoid(double x)
{
  return 1.0 / (1.0 + exp(-x));
}

double classifier_predict(double *input)
{

  double weights_layer1[NUM_FEATURES][64] = {{0.2574224, -0.16492712, 0.19797958, -0.12944292, 0.25352156, 0.22459729,
                                              0.11458535, -0.1420074, 0.11915506, 0.2310801, 0.18234693, 0.16680224,
                                              -0.18201056, -0.10250713, -0.238526, -0.07052686, 0.11354877, -0.08702158,
                                              0.17011325, -0.20582935, -0.26881814, 0.17810732, -0.00458719, 0.18736833,
                                              0.15323135, -0.00837473, 0.25642923, 0.27338547, -0.24006964, 0.1630266,
                                              -0.10681065, 0.01050134, -0.191978, -0.14343412, -0.1380871, 0.09889076,
                                              0.06430244, 0.05325406, -0.1737459, -0.06907726, 0.01648417, 0.07959294,
                                              0.2147004, -0.22552001, 0.17199257, 0.01007916, -0.02340786, -0.25063506,
                                              0.17144933, 0.21508326, -0.12563181, -0.14299656, -0.08715379, 0.04670035,
                                              0.18899445, -0.16672353, 0.02057211, 0.08328488, -0.16985448, 0.19537112,
                                              -0.10524897, 0.11710985, -0.11589839, 0.1118876},
                                             {-0.1254847, 0.00262879, 0.17936811, 0.08765195, -0.02787394, -0.06265067,
                                              0.21825257, 0.20205727, -0.11610911, 0.20957123, -0.08032886, -0.04031195,
                                              -0.09556225, -0.11111262, -0.19347417, 0.24612808, 0.06406148, 0.04910864,
                                              0.00425108, -0.03542315, 0.04862206, -0.03370272, -0.02763451, -0.22616477,
                                              -0.08001821, 0.26338685, -0.09172364, 0.04220721, 0.2849473, -0.01700365,
                                              -0.25381595, -0.2182964, 0.00402624, -0.16713163, -0.15307178, -0.1333594,
                                              -0.14210592, 0.03158358, -0.16707888, -0.04198332, 0.20505236, 0.04813059,
                                              0.17672116, 0.03868049, 0.02287398, -0.11205278, -0.09605536, 0.01996094,
                                              0.02929927, -0.17085822, 0.05058105, 0.08044968, -0.07429819, -0.13682726,
                                              0.040758, 0.07273842, -0.1929558, -0.18067752, -0.03474246, -0.10766263,
                                              -0.24081284, 0.180882, -0.05013807, -0.04038148},
                                             {-0.00563558, -0.18077502, -0.05054194, -0.19154826, -0.22021736, 0.23989268,
                                              0.05450582, -0.00448071, 0.1199736, -0.18610382, -0.1057127, 0.2309683,
                                              0.16469961, 0.23895693, 0.08475092, -0.10425214, -0.31481242, -0.10190923,
                                              0.01798084, -0.11419587, 0.04903136, -0.00000533, -0.16689095, -0.07661568,
                                              -0.20527183, -0.03390803, -0.00288884, -0.17842798, -0.19263017, -0.00884268,
                                              -0.07111778, -0.16384529, 0.084924, -0.1954744, -0.14638266, 0.19772802,
                                              -0.04614399, 0.06775013, -0.01242764, 0.21846622, 0.02992669, -0.05989749,
                                              0.25419968, 0.18442503, 0.08969265, 0.26566878, -0.01484889, 0.23465575,
                                              -0.02244838, 0.01122046, 0.15457381, -0.06818441, 0.1644091, 0.2684104,
                                              0.16997416, 0.25459838, 0.22877623, -0.10172697, 0.24196975, 0.10041627,
                                              -0.25137576, -0.14036548, -0.01145233, 0.1931835},
                                             {0.1869803, 0.13039468, -0.05348242, -0.15937942, 0.23507182, -0.11899333,
                                              -0.20925653, 0.06558817, 0.14645481, 0.05417693, 0.2698221, 0.17843698,
                                              -0.07502019, -0.08855337, 0.0981067, -0.07704906, 0.1169481, -0.23608449,
                                              0.14446075, -0.0245384, 0.08968589, -0.05101907, -0.22289066, 0.01566133,
                                              0.08109704, -0.12770067, 0.18143383, -0.13733326, -0.11405066, 0.02667459,
                                              0.03868833, -0.11702818, -0.2155152, -0.09675603, -0.20771173, -0.01643258,
                                              -0.02923458, -0.16417229, 0.18019821, -0.25774083, -0.10468777, -0.24016842,
                                              -0.24534838, 0.09641412, -0.1675827, -0.11846859, 0.07369914, 0.01728851,
                                              -0.06164131, -0.14001484, -0.05977588, -0.14450854, -0.12930766, -0.27392888,
                                              0.13136345, -0.03110477, -0.16473278, -0.11712313, -0.07081503, 0.0589104,
                                              0.08761974, 0.07252706, 0.08335631, 0.00304146},
                                             {-0.1718478, 0.00391347, 0.07466739, 0.08256402, -0.23235084, 0.20018362,
                                              0.29201725, 0.07457186, 0.03160765, 0.20959173, -0.09768099, -0.01664391,
                                              -0.1452923, -0.01569933, -0.12918152, -0.19266367, 0.06410479, 0.16739322,
                                              -0.03019953, -0.17250331, 0.23374262, 0.08257327, -0.16510384, -0.16245593,
                                              0.09166864, 0.12647323, -0.11500093, -0.0234593, 0.07033648, -0.01067776,
                                              0.11486612, -0.06162432, -0.21050559, -0.20285308, -0.20080712, -0.2078949,
                                              0.10504392, -0.15305158, -0.06848416, 0.00473514, -0.05104503, 0.10803448,
                                              0.15746284, 0.26309812, -0.05913339, -0.11298862, -0.02456166, -0.15311989,
                                              -0.15603302, -0.0025009, -0.0354263, -0.21648633, -0.0106806, 0.05911671,
                                              0.23664302, -0.10414311, -0.1899359, 0.0509161, -0.01078871, -0.1267,
                                              -0.16486192, 0.20482343, 0.00988678, 0.25617066},
                                             {0.10703523, 0.03000402, -0.31644416, 0.14726517, -0.17557423, -0.11633044,
                                              -0.13062449, -0.19626692, -0.24519448, 0.1037005, -0.11379532, 0.07264918,
                                              -0.17081907, -0.15059315, -0.03891458, 0.04089297, 0.02622408, 0.02541693,
                                              0.20929319, 0.18199204, -0.0996495, 0.11133964, -0.18213585, -0.18056767,
                                              0.11085837, -0.21961392, 0.11527764, -0.16582419, -0.27363566, 0.0859446,
                                              0.05710041, -0.14442869, -0.21206054, -0.07346, -0.19398072, -0.20866302,
                                              0.17861502, 0.11210945, 0.23418882, 0.05321353, -0.13373609, 0.22250836,
                                              -0.09209161, -0.18391138, -0.16816479, 0.11577139, 0.16805506, -0.09600658,
                                              -0.13013177, 0.13896672, -0.18031377, 0.12439504, 0.20537022, 0.06404162,
                                              0.26085997, 0.10853335, -0.20612434, 0.05084739, -0.2019092, -0.22182797,
                                              -0.1467841, -0.12439434, 0.0979216, -0.21835113},
                                             {-0.06473185, -0.07949213, 0.19598858, -0.1589015, -0.30312562, 0.16538598,
                                              -0.10959489, 0.22710404, -0.1180329, 0.14720897, -0.1601813, 0.04603782,
                                              -0.1985091, 0.27036577, 0.01748971, 0.09493552, 0.11552308, -0.17939125,
                                              -0.19557464, -0.14047633, -0.19099517, -0.12452112, -0.17097999, 0.00621043,
                                              -0.01699999, 0.01560807, 0.04207021, 0.2286605, 0.08296467, 0.03068922,
                                              0.02522528, -0.19898339, -0.09413011, -0.23952506, -0.09362847, -0.06073412,
                                              0.17770298, 0.23522851, 0.10548478, 0.19086629, 0.0119441, -0.21591577,
                                              0.00993, -0.14801912, 0.1966937, 0.06056272, 0.26729286, -0.09516384,
                                              0.14903443, -0.19797373, 0.10479652, -0.02598634, 0.20772757, 0.01317937,
                                              -0.07921997, 0.16686834, -0.277578, -0.25464904, 0.1846652, -0.22644562,
                                              0.0467257, 0.21514829, -0.20353009, 0.28189746},
                                             {0.17603964, -0.21037027, -0.2384147, 0.24405235, -0.09161676, -0.08570173,
                                              -0.26412588, -0.22624385, 0.22850187, -0.2625198, -0.14688025, 0.17421168,
                                              -0.05495873, -0.10834572, -0.15551908, -0.19522536, 0.3135027, 0.00913072,
                                              0.00281673, -0.24063076, 0.11148277, -0.24103597, -0.04319502, 0.03285828,
                                              0.20318604, -0.10086258, -0.17905465, 0.03304566, -0.245903, 0.03290315,
                                              0.29733524, -0.05803499, -0.1922863, 0.18716922, 0.14298657, -0.060855,
                                              0.21923228, 0.03823, -0.06277498, -0.06372967, 0.1894166, 0.1787001,
                                              0.0293349, -0.00013727, 0.03568488, -0.13011801, 0.18482323, -0.07916313,
                                              -0.27327818, -0.2227141, 0.16710715, -0.06979735, 0.1112766, -0.15508378,
                                              0.1397439, 0.03441482, -0.07043019, -0.2194253, 0.10617157, 0.23245974,
                                              0.17428423, -0.03936552, 0.05076297, -0.01288369},
                                             {-0.22939847, -0.22944604, 0.0945224, 0.0553274, -0.06598604, -0.12430509,
                                              -0.22626269, -0.2931422, -0.13143377, -0.0375282, 0.09893767, 0.0859141,
                                              -0.1883484, -0.03642992, 0.16176338, -0.15743928, -0.0709715, -0.17787944,
                                              -0.08435215, 0.20134334, -0.2470771, -0.06709518, -0.15038878, 0.05166338,
                                              -0.2853897, 0.11858209, 0.29425174, 0.14185676, -0.27639282, -0.07662173,
                                              -0.13730507, 0.17442727, 0.2518632, 0.05201594, -0.12834136, 0.02831603,
                                              0.13241336, 0.05011408, -0.26846424, 0.149738, -0.14903574, -0.32113695,
                                              -0.18861313, -0.17293602, 0.12560974, 0.03633223, 0.08043986, -0.09999564,
                                              0.15689127, -0.1699249, -0.03186584, 0.05249227, 0.22223622, -0.05254853,
                                              0.15420106, 0.0674399, -0.02279817, 0.1966184, 0.03850389, -0.25842834,
                                              0.11574055, -0.22989936, -0.07525325, 0.20353349},
                                             {0.2774611, 0.18290403, -0.15443593, 0.19147983, -0.06691396, 0.18272391,
                                              -0.19569534, -0.14966272, 0.00875861, -0.1177947, 0.20974311, 0.23799387,
                                              0.14375424, -0.3104484, 0.00297748, 0.05751462, -0.01816042, 0.06457262,
                                              -0.02009363, -0.13511732, -0.2318872, -0.2416886, -0.02297328, -0.01196626,
                                              -0.19270085, -0.0925467, -0.00725847, 0.01711701, 0.02785089, 0.16373996,
                                              -0.25436783, -0.06842973, 0.051674, 0.29876485, -0.11646615, -0.07319602,
                                              -0.07070685, 0.04035908, -0.19482578, -0.05197808, 0.1870943, -0.2094323,
                                              -0.02047134, -0.13946322, 0.04704872, -0.12834246, 0.13183321, -0.14999434,
                                              -0.09945413, -0.09180208, 0.15937161, 0.2128124, 0.11017863, -0.2394107,
                                              0.21343108, 0.11165714, 0.11029697, 0.2722667, 0.14794463, -0.07113725,
                                              -0.09822475, 0.22647099, -0.1240024, -0.15005644}};
  double biases_layer1[64] = {0.04780108,
                              -0.00363113,
                              -0.06406383,
                              -0.05851799,
                              -0.04768917,
                              -0.07695745,
                              -0.04981108,
                              -0.05015937,
                              0.00244248,
                              -0.07984146,
                              0.04567553,
                              -0.03802528,
                              -0.04618715,
                              -0.00751864,
                              -0.02993012,
                              -0.01169264,
                              0.01696206,
                              -0.02668099,
                              -0.08251883,
                              -0.00526897,
                              -0.00405066,
                              -0.02498951,
                              0.00907609,
                              0.02968363,
                              -0.00516273,
                              -0.05584546,
                              -0.01074605,
                              -0.05556333,
                              0.03247338,
                              0.00565631,
                              -0.02073538,
                              -0.06096406,
                              -0.04856589,
                              0.03511585,
                              0.00061684,
                              -0.02125956,
                              -0.02037671,
                              -0.02004251,
                              -0.06121479,
                              -0.01003756,
                              -0.02899324,
                              -0.0321748,
                              0.01796495,
                              -0.04396419,
                              -0.04626932,
                              0.01395335,
                              0.00894723,
                              0.02026143,
                              -0.06233437,
                              -0.0363019,
                              -0.03581293,
                              -0.05096221,
                              -0.0411413,
                              0.0462177,
                              -0.05317402,
                              -0.03521802,
                              -0.06762435,
                              -0.03822978,
                              -0.03731591,
                              -0.03126264,
                              0.00512101,
                              -0.06990587,
                              -0.06886879,
                              -0.02571531};

  double weights_layer2[64][32] = {{-0.14739953, -0.26386514, -0.12517895, -0.0692165, -0.17939343, 0.10368889,
                                    -0.10292059, -0.06855685, -0.18357286, 0.08623593, -0.02697693, 0.17605104,
                                    0.17912441, -0.18571317, -0.23103286, 0.04492638, -0.07290829, 0.24251208,
                                    -0.05119693, 0.13104993, -0.2390539, -0.09518495, -0.22957563, -0.11488605,
                                    -0.2611879, -0.16839789, 0.07422365, 0.01180643, 0.04998633, 0.22077961,
                                    -0.23682436, -0.12768638},
                                   {0.11681065, -0.04284951, -0.01434536, -0.00909987, 0.23398761, -0.01532408,
                                    0.03450898, -0.19734727, -0.02599484, 0.25651383, 0.07935032, -0.00099035,
                                    0.2699685, -0.23051077, 0.14297122, -0.10389864, 0.03343052, 0.08302644,
                                    -0.04870765, -0.24577095, 0.04990108, -0.0821954, 0.13530055, 0.16578266,
                                    -0.2634832, -0.07419942, -0.10572793, 0.14651789, 0.0668513, -0.22484455,
                                    -0.11797766, -0.18912748},
                                   {0.23039962, 0.18869591, 0.14826518, -0.03460937, -0.11244859, 0.23433018,
                                    -0.26340002, 0.12201995, -0.1342826, -0.20631054, -0.16112034, -0.08835534,
                                    0.03966548, 0.19367187, -0.14983086, -0.01465188, 0.07158121, -0.0530377,
                                    -0.02153957, -0.02329417, 0.11274817, 0.05738325, -0.14298613, -0.02157047,
                                    -0.05348844, -0.21065855, -0.14824924, 0.10285484, 0.03639918, -0.2502409,
                                    0.04700761, 0.1476878},
                                   {0.08519106, 0.03027396, -0.13187946, 0.24843177, -0.05810777, 0.08907296,
                                    0.07196037, 0.100184, -0.2674322, -0.05834853, 0.18915254, 0.09458437,
                                    0.14422478, 0.12011679, 0.21596953, -0.19921035, 0.03054154, -0.22956163,
                                    -0.08506814, -0.14022993, 0.07175791, 0.11848605, -0.16928281, 0.137407,
                                    -0.21778782, 0.07910249, 0.10721494, 0.14420438, -0.11566839, -0.13697189,
                                    -0.08989441, 0.13318944},
                                   {0.10630792, -0.06561774, 0.18128347, 0.01212111, -0.08498417, 0.17809774,
                                    0.19154465, -0.19112064, -0.12040731, 0.22308369, 0.08839541, 0.18223682,
                                    -0.05621957, -0.03782223, 0.21060602, -0.06857777, 0.11452812, -0.03806248,
                                    0.10024103, -0.00463641, -0.12608476, -0.06766365, 0.13154119, 0.05339635,
                                    0.04665133, 0.00849678, 0.05311733, -0.06546719, -0.29435384, 0.16720186,
                                    0.15694079, -0.15382315},
                                   {0.02816826, 0.1380345, 0.13949205, -0.14747517, 0.15242341, -0.09308909,
                                    -0.13028723, 0.16105978, 0.03030425, -0.17466956, 0.12766406, 0.1760321,
                                    0.05959849, 0.10551909, -0.10748696, 0.04297616, 0.22236334, 0.13555716,
                                    0.10686365, -0.1065146, 0.02723518, -0.14640386, -0.01621339, 0.13669352,
                                    -0.06369235, -0.10279459, 0.10947132, 0.15541409, 0.2213634, -0.15579794,
                                    0.252491, 0.17985687},
                                   {-0.23573954, -0.16218634, -0.06268802, 0.18109472, 0.16817598, -0.0234371,
                                    -0.01173639, 0.05268189, -0.10701654, 0.00870547, -0.08018472, -0.02219418,
                                    -0.12190594, -0.23793784, 0.08543392, -0.22730444, 0.04315418, -0.22854955,
                                    0.03006932, -0.01911876, -0.22367024, 0.24142751, -0.00779611, -0.02811474,
                                    0.10284735, -0.24513425, 0.03907098, 0.04606148, -0.19254845, -0.00081659,
                                    0.03121539, 0.16859289},
                                   {-0.17382841, -0.05910541, -0.12655747, 0.07107853, 0.0880653, -0.12805176,
                                    -0.16457008, 0.02241224, -0.02661365, -0.00481579, -0.15761574, -0.27206254,
                                    -0.14938922, -0.2477249, -0.10096486, -0.15466896, -0.22930315, 0.06375211,
                                    0.16601795, -0.11505976, -0.1889714, -0.1108235, -0.06173637, -0.20231329,
                                    0.19309843, 0.15873635, 0.14953546, -0.0353997, -0.10154866, 0.00594623,
                                    -0.14249301, -0.12621945},
                                   {-0.13756706, -0.14080791, 0.1045167, -0.12328149, -0.12327691, 0.06680634,
                                    -0.09374424, -0.08365074, 0.00644116, -0.0973541, -0.07870107, -0.02226493,
                                    0.00540891, -0.20894411, 0.07063222, 0.00637162, -0.00991466, 0.20916772,
                                    0.17569785, -0.08127069, 0.0982061, -0.05648937, -0.08170483, 0.2143665,
                                    -0.08659237, 0.10649084, -0.02792895, -0.00754139, -0.14461179, 0.05425204,
                                    -0.14437078, -0.1328822},
                                   {0.11443007, 0.13684495, 0.13327663, -0.19918387, 0.0127067, -0.25343823,
                                    -0.20821644, -0.16463488, 0.14051926, -0.06854308, 0.20769241, 0.15110566,
                                    0.22438377, 0.20757906, 0.04606116, 0.04668445, -0.13331658, -0.18646511,
                                    -0.22104639, -0.28966808, 0.13229746, -0.064901, 0.09009589, -0.25536337,
                                    -0.09621456, 0.0449894, 0.18524958, 0.09114725, -0.27063075, 0.00890717,
                                    0.22107017, 0.00369044},
                                   {0.15720136, 0.0654129, -0.07794743, 0.04702414, -0.07305512, -0.03808505,
                                    -0.15353692, -0.22632997, 0.11792322, 0.16198152, -0.24064028, -0.0239177,
                                    -0.2104034, 0.03598021, -0.10255127, 0.27004096, -0.20056099, 0.06989683,
                                    -0.04251328, -0.1947154, -0.22361049, -0.09281892, -0.20404632, 0.14273511,
                                    -0.08738201, 0.04311372, 0.09620006, 0.13660328, -0.2637291, 0.17048621,
                                    0.07491822, -0.1443414},
                                   {-0.2296087, 0.00859484, 0.19212534, -0.19516039, -0.21601485, 0.10430142,
                                    -0.12196382, 0.07466048, 0.12798719, 0.15385914, -0.02874487, -0.00344047,
                                    -0.1525492, 0.10697845, -0.16853516, 0.11472254, -0.05450639, -0.11746202,
                                    -0.1203686, 0.13513057, 0.06826986, 0.14675923, 0.19354276, 0.19638179,
                                    -0.16616854, 0.16561897, -0.23961183, 0.07410218, 0.11557134, -0.10419694,
                                    -0.04824169, -0.17115313},
                                   {-0.1609684, -0.06842506, -0.19334556, -0.04688544, 0.17023607, 0.20687762,
                                    -0.15144709, 0.09035442, 0.05476905, -0.12325841, 0.03251143, -0.20447229,
                                    -0.0252969, -0.01788116, 0.12991492, -0.21371645, 0.10208999, -0.07776845,
                                    0.00003413, 0.19624999, -0.11060763, 0.23193263, -0.08395366, 0.10452443,
                                    -0.04645127, -0.04649268, -0.24792565, 0.01449944, 0.07579097, 0.13824828,
                                    -0.00466887, -0.12161717},
                                   {-0.02461633, 0.24704666, 0.23464099, 0.13951162, 0.10699522, 0.11457773,
                                    -0.21840352, -0.04692386, 0.2940574, -0.25909513, 0.0644144, 0.11020704,
                                    -0.28011078, -0.05456022, -0.17057973, -0.14440177, -0.06309825, 0.08911888,
                                    -0.08111873, 0.12404282, -0.078849, 0.06013859, -0.14526805, -0.14990275,
                                    -0.17238528, -0.08107328, -0.08864134, -0.02260414, 0.2149363, -0.1846474,
                                    0.18733646, 0.2511405},
                                   {-0.14375283, -0.17757058, -0.10229008, 0.1187686, 0.08802883, -0.0120362,
                                    -0.11918832, -0.26611936, 0.10834876, -0.01576693, -0.14496021, 0.12053942,
                                    -0.03799948, -0.10136922, -0.06226036, -0.06510998, 0.02518986, -0.24336612,
                                    0.02345434, -0.1914728, -0.11140973, -0.1566741, 0.15081924, 0.07063115,
                                    -0.17827381, -0.08294787, 0.1877773, -0.22122447, 0.23267497, 0.00145024,
                                    0.20889819, 0.02680209},
                                   {0.01855303, 0.00026654, -0.08503339, 0.25282934, -0.23891304, 0.16081183,
                                    -0.22294489, -0.09501866, -0.04674301, -0.10691353, -0.05319612, -0.19478843,
                                    -0.08153713, 0.01191203, -0.22718711, -0.12823552, -0.05718315, 0.15897375,
                                    -0.19402018, 0.00108597, -0.0494694, 0.14837481, 0.00698694, -0.25375864,
                                    -0.09581204, 0.1805586, 0.1557242, -0.12298284, 0.07993101, 0.20614427,
                                    0.08434883, -0.1068349},
                                   {-0.09927148, 0.15710008, -0.18475991, 0.27430117, 0.06089536, 0.07639299,
                                    0.22329378, 0.19107847, 0.18603973, 0.08350112, 0.00950137, 0.17093225,
                                    0.26191488, 0.03509498, -0.1168553, 0.24605519, -0.13831505, -0.11814997,
                                    0.17848833, -0.2555692, 0.13322155, 0.04597221, -0.04496969, 0.13676852,
                                    -0.10452189, -0.19552389, 0.06301285, 0.12116811, -0.18497038, 0.07671966,
                                    0.01274584, -0.26316747},
                                   {0.0483172, 0.06441389, -0.20755146, 0.06088074, -0.0370202, -0.08544261,
                                    0.02310332, 0.23995996, -0.16229358, -0.18892191, -0.01348206, -0.22904281,
                                    0.13651364, -0.17985232, -0.1971821, 0.20054358, 0.10806353, -0.15670061,
                                    -0.07698689, 0.14758335, -0.0598334, -0.0608076, -0.17867884, 0.19370592,
                                    -0.24045962, 0.10191266, 0.16388844, 0.01324142, -0.00604231, -0.16020517,
                                    -0.25394255, 0.06169571},
                                   {0.22121124, -0.18318425, 0.164261, 0.19415198, -0.14417279, -0.072606,
                                    -0.10622875, -0.02553975, 0.00490641, 0.2506275, -0.04734129, 0.12957314,
                                    -0.10994241, 0.02360156, -0.11396591, 0.06676349, 0.26597556, -0.04028638,
                                    0.04427687, -0.08788375, -0.04724365, 0.14915553, 0.0842434, 0.10452963,
                                    0.11270519, -0.20145316, -0.22796415, -0.01247745, -0.26109856, -0.09405809,
                                    0.09699412, -0.1886475},
                                   {0.05661714, -0.08619015, -0.08265059, -0.03510074, -0.10752683, 0.19913286,
                                    0.17694394, 0.07519154, 0.11571868, 0.05932039, 0.04975375, -0.13564216,
                                    -0.01330787, -0.00038219, -0.17361917, -0.07314972, -0.07783635, 0.16293097,
                                    0.14015236, 0.03290566, 0.07877894, 0.10279771, -0.21333767, -0.17426053,
                                    -0.21426447, 0.26360285, 0.10162511, -0.02394434, 0.19243196, 0.16158263,
                                    -0.22132401, 0.21436419},
                                   {0.10249858, -0.25686988, -0.07653494, -0.13021551, 0.10644921, -0.21904545,
                                    0.09832905, 0.20142439, -0.19280715, -0.22362216, 0.2148917, 0.00403817,
                                    0.09060044, 0.15885055, 0.19914404, -0.20067503, 0.0162372, -0.23733033,
                                    -0.22101775, 0.19756494, -0.13758312, 0.02810216, -0.05483999, -0.08023638,
                                    -0.04290286, 0.1077849, -0.26293343, -0.07209218, -0.17041256, 0.01407151,
                                    0.10603622, -0.14921464},
                                   {-0.09448653, 0.190762, -0.20468342, -0.09686831, 0.10187955, 0.15213704,
                                    0.1026523, -0.21625207, -0.19951029, 0.08176672, -0.11393008, -0.25412548,
                                    -0.17803688, -0.09244424, -0.0867885, -0.06925753, 0.03932258, 0.0157049,
                                    0.07538524, 0.1182546, 0.08554424, -0.22988157, 0.13586566, 0.00994735,
                                    0.07398746, 0.14571647, -0.1679079, -0.08415063, 0.03365723, -0.11744933,
                                    0.12210245, 0.131076},
                                   {0.01953014, -0.14592667, 0.15373494, -0.1992531, -0.11701566, -0.22170493,
                                    0.07512451, -0.18750918, 0.12104641, -0.02068074, -0.0532072, -0.1436254,
                                    0.22250715, -0.14397955, -0.19286762, 0.07524838, 0.27514347, -0.11832619,
                                    0.15552326, -0.20896603, 0.13375993, -0.16302924, -0.13745183, 0.04967578,
                                    -0.2123345, -0.2386138, 0.06396721, 0.01240423, 0.15187071, 0.06450726,
                                    0.1357953, -0.15315601},
                                   {0.08349247, 0.20866226, -0.22138031, -0.23049167, -0.07853242, -0.24165285,
                                    0.31949958, 0.24757776, 0.1004118, 0.07016298, -0.1457698, 0.19654119,
                                    0.13653247, -0.14656405, -0.09461079, 0.05294287, 0.01125286, -0.1373647,
                                    0.22710954, -0.17891194, -0.10773471, 0.1799364, -0.0010735, -0.12867393,
                                    -0.05340002, 0.21422428, 0.03224722, 0.07174158, -0.08117789, 0.24487612,
                                    -0.21028413, -0.00507432},
                                   {-0.24783793, 0.19052653, 0.04439303, -0.0109968, -0.08852534, -0.07078864,
                                    0.07293684, 0.18456493, -0.04631226, -0.11677699, 0.02640492, 0.13054433,
                                    -0.00243992, -0.17251061, -0.18703331, 0.00644141, 0.2226543, -0.09805568,
                                    -0.01497588, 0.03724929, -0.15759905, -0.07672848, 0.02921946, 0.13346611,
                                    -0.20976521, -0.0696114, -0.25918373, 0.12995295, 0.17815813, 0.01186968,
                                    -0.25368813, 0.14706714},
                                   {-0.19850837, 0.11049066, 0.09120516, -0.00751408, -0.10894143, 0.08634701,
                                    0.07251871, 0.13144144, 0.19584665, -0.23361011, -0.11566021, 0.13860099,
                                    0.07399184, 0.20448011, -0.21929257, -0.09824436, 0.05925175, 0.03254614,
                                    0.03514192, 0.0782412, -0.01842962, 0.22551826, 0.14686178, 0.03288751,
                                    -0.25739315, -0.17105557, -0.13316688, -0.25121033, -0.24248938, 0.1273009,
                                    0.07573111, 0.1855352},
                                   {-0.01125694, -0.16398038, -0.18024252, -0.00331398, -0.11679256, -0.14227267,
                                    0.22473569, -0.10045851, 0.24932535, 0.09914264, 0.01499642, 0.111807,
                                    0.09885658, -0.11339024, -0.1323524, 0.07316461, 0.21916029, -0.1114022,
                                    0.07469346, -0.14455287, -0.17505978, 0.08139486, -0.17805408, -0.15536563,
                                    0.11203849, 0.01634564, 0.10918287, -0.28958395, 0.00316929, 0.00431894,
                                    -0.04256233, 0.16426316},
                                   {0.06945513, 0.04506357, -0.04778906, 0.08473732, -0.04856825, -0.00476888,
                                    0.18348761, -0.15529461, 0.1002524, 0.19948032, -0.05335473, 0.05487976,
                                    0.20926982, -0.00445324, 0.13396172, -0.21837659, 0.10089742, -0.24272314,
                                    0.1465122, -0.08095039, -0.2768612, -0.087217, -0.1028593, 0.11445104,
                                    -0.10233647, 0.13378492, -0.14698909, -0.19823807, -0.2436978, -0.07835123,
                                    0.15746242, -0.11180082},
                                   {0.20292172, -0.13471848, -0.15427168, -0.11156644, 0.17272305, -0.19618426,
                                    0.2744657, 0.13868819, -0.0569807, -0.021762, 0.11937193, -0.20818639,
                                    -0.18165565, 0.10445252, -0.2028391, -0.23690054, 0.17435074, 0.1324186,
                                    -0.16392761, 0.08331602, 0.07568379, -0.1767767, -0.06045168, -0.20665891,
                                    -0.23870465, -0.09698853, 0.03987788, -0.19783892, -0.15938112, -0.15614581,
                                    -0.1879982, -0.15183459},
                                   {-0.2144602, -0.14790957, -0.19840093, -0.12007362, -0.10681006, 0.2562708,
                                    0.16958117, -0.05921146, -0.10372691, -0.10951132, 0.12446661, 0.13541928,
                                    0.18139483, 0.18334596, -0.03609516, -0.22288135, -0.01639155, -0.04490223,
                                    0.03150161, 0.0877762, -0.03429861, -0.09662367, 0.17587537, -0.14174742,
                                    0.09988097, -0.20883949, -0.1782306, 0.02171014, -0.02930361, 0.18624073,
                                    -0.09029555, 0.15217182},
                                   {-0.13765402, 0.10843434, -0.12401436, 0.03426891, -0.06889798, -0.02866603,
                                    0.2874879, -0.16647893, -0.00963108, -0.05107726, -0.17986709, 0.27728355,
                                    -0.1513712, -0.26438513, 0.05149135, 0.04481848, 0.09284671, -0.13977003,
                                    -0.08741097, 0.19419302, -0.2911772, 0.11992463, -0.0589029, -0.20033896,
                                    -0.12276118, 0.19167584, 0.1019096, 0.11452008, -0.09958037, -0.03711236,
                                    -0.09912536, -0.21039411},
                                   {-0.2565311, -0.08212512, -0.05639306, 0.12289405, 0.21663003, 0.06478678,
                                    -0.18738398, 0.01961956, -0.18066515, -0.25834045, -0.09438932, 0.06171184,
                                    0.1879755, 0.07240898, 0.15794832, 0.07346492, -0.22858407, -0.00344185,
                                    0.0128054, -0.19865121, -0.23940502, -0.14081497, 0.15117435, -0.2370627,
                                    0.05973916, -0.11657817, -0.0705092, -0.19985652, -0.14982904, -0.07832058,
                                    0.1454304, -0.12931687},
                                   {0.05744597, -0.08846097, 0.00983081, -0.12286897, -0.2617126, 0.14608827,
                                    0.19492637, -0.2560913, -0.16288014, 0.11024294, -0.1195554, 0.17762494,
                                    0.09465749, -0.20265613, -0.19885726, 0.03036664, -0.21453758, 0.09611295,
                                    -0.02260617, 0.07006281, 0.06772274, 0.10879623, 0.0990647, -0.12802759,
                                    0.07772352, 0.03503653, 0.17559026, 0.02319348, 0.07686689, 0.0779367,
                                    0.08223655, -0.00699028},
                                   {0.12683325, -0.16190681, 0.06128487, 0.16914931, 0.1835169, -0.141327,
                                    0.22622931, 0.10745949, 0.11125413, -0.26105216, -0.2210406, 0.01892621,
                                    -0.12484734, -0.06774034, -0.12817973, 0.02711803, 0.095676, -0.2580754,
                                    0.06915005, -0.11380642, 0.00700464, -0.02548229, -0.05906929, -0.04784213,
                                    0.18554792, -0.14666782, 0.13877651, 0.18540157, -0.16167954, 0.04098102,
                                    -0.22730646, 0.10173718},
                                   {-0.10804903, 0.14191924, 0.04140833, -0.02283097, -0.2149047, -0.00572724,
                                    0.02678386, 0.16709979, 0.04962109, -0.22039953, 0.05231601, -0.11577284,
                                    -0.14536916, 0.16978322, 0.23141631, 0.0917419, -0.11210328, 0.17854196,
                                    0.07143882, -0.06982394, 0.1022645, -0.05464308, -0.12704502, 0.09325828,
                                    -0.03662056, -0.27215743, 0.13871299, -0.23000516, -0.10347439, 0.18463118,
                                    -0.07415994, 0.02816293},
                                   {-0.19800001, -0.20481394, -0.12233625, -0.1853289, 0.16078766, 0.27006808,
                                    -0.11379951, -0.11190455, 0.1431904, -0.23346913, 0.26716927, -0.08882186,
                                    0.12325465, -0.26192623, 0.05914197, 0.17225796, 0.10835382, 0.02288571,
                                    -0.29154316, -0.05816006, 0.17900158, 0.17149574, 0.02204178, 0.21840009,
                                    -0.06058857, -0.10117756, 0.22452097, -0.15744014, 0.09881587, -0.08056872,
                                    -0.16366461, 0.23292924},
                                   {-0.15162238, -0.21569249, -0.10311388, 0.19786079, -0.16149183, -0.06920929,
                                    0.00336007, -0.24233232, 0.0121526, 0.23975223, 0.10654462, 0.06727313,
                                    0.20281367, 0.12790115, -0.01103877, 0.17704631, 0.17842166, -0.01236992,
                                    -0.19613093, 0.21284416, 0.08750408, -0.2462481, 0.18746404, 0.17406844,
                                    0.06909958, -0.01073391, 0.15237911, -0.22075866, 0.23820402, 0.20382343,
                                    -0.01809084, 0.09142789},
                                   {-0.23536988, 0.19702293, 0.20925038, -0.26683342, -0.19414113, 0.05365311,
                                    0.02401637, 0.01068118, 0.15392831, -0.20134644, 0.1561219, -0.28118068,
                                    -0.12470784, -0.15421022, -0.2089784, 0.09753472, -0.070857, 0.03130788,
                                    0.13061234, 0.19182068, 0.17597908, 0.14129765, 0.07051717, 0.22476849,
                                    -0.23314792, -0.19156042, 0.18371634, -0.01860411, -0.14143655, -0.19227445,
                                    -0.21135007, -0.10530909},
                                   {0.04752688, -0.17654169, 0.09640529, -0.07044655, 0.09611337, -0.1591905,
                                    0.20461057, -0.11668329, 0.1284782, 0.08115601, -0.23190856, -0.16589278,
                                    -0.07481223, -0.02583417, 0.10376759, 0.2887989, -0.15365161, 0.08920117,
                                    -0.00215279, 0.19103923, -0.2315292, -0.1397389, 0.09039964, 0.02821689,
                                    0.14759792, 0.01216268, -0.16807769, 0.06193433, -0.19071451, -0.22167449,
                                    -0.14855398, 0.15816012},
                                   {-0.04689019, 0.24361075, 0.3009268, -0.26594898, 0.06535397, 0.09302534,
                                    -0.23341721, -0.19608146, 0.02546754, 0.12201539, 0.3023674, 0.11239134,
                                    -0.1346282, 0.13355121, -0.30351338, -0.06038333, 0.0849456, -0.04561833,
                                    -0.09262272, 0.17837551, -0.18890326, 0.00615603, 0.01010278, 0.07931037,
                                    0.10086582, 0.19266574, -0.10744509, -0.04254192, 0.24492733, -0.1127631,
                                    0.37168032, 0.02274967},
                                   {-0.13005207, 0.16974376, 0.07465244, 0.23374256, -0.24009009, -0.11760762,
                                    0.23251753, -0.02938675, -0.16991432, -0.01564399, 0.17405732, 0.14997429,
                                    -0.07222189, -0.13811502, 0.00562668, 0.05783141, -0.09803447, -0.15178864,
                                    -0.18511401, -0.09145431, -0.10805377, -0.13243455, -0.01748575, -0.2617862,
                                    -0.02722019, -0.01195353, -0.07968035, 0.06568132, -0.02178401, -0.02625213,
                                    -0.12698619, -0.09653984},
                                   {-0.06351062, -0.11369591, 0.1905744, 0.02627097, -0.19017361, 0.03989653,
                                    0.10700081, -0.13583605, -0.24371976, 0.04376292, -0.19118299, 0.18999271,
                                    -0.19123046, 0.04421256, -0.08937253, -0.21585542, 0.13579081, -0.04687934,
                                    -0.13553755, 0.05652956, 0.2102156, -0.09015683, -0.08929308, -0.1742668,
                                    0.14645009, 0.01836673, -0.13692525, 0.0128064, 0.06730111, 0.13664383,
                                    0.10343166, -0.22435911},
                                   {-0.18823919, -0.09667067, 0.02800216, -0.29281133, 0.03655247, 0.13880835,
                                    0.03799307, -0.0131291, 0.10931148, 0.16497456, 0.03898683, 0.0451831,
                                    -0.04893059, -0.17197882, -0.10905481, -0.2964846, 0.16131401, -0.28984135,
                                    -0.01389926, -0.18585049, 0.23425671, -0.03791779, -0.1850608, -0.02241547,
                                    0.1652099, -0.15188767, 0.1678003, -0.31350747, 0.10856922, -0.10899168,
                                    0.09997218, 0.11690528},
                                   {-0.13746859, 0.1792733, 0.1041702, 0.05344885, 0.05300603, 0.16788661,
                                    0.25530916, -0.14079195, 0.21631764, 0.04773646, -0.12525871, 0.15920116,
                                    -0.13085486, 0.04004556, -0.12582843, 0.08910146, 0.08568535, -0.14054006,
                                    0.19322707, -0.20733126, -0.14768122, 0.15912385, -0.1709623, 0.05036456,
                                    0.20002575, -0.14824407, -0.25355348, 0.21760236, -0.00373327, -0.23449391,
                                    0.19997269, -0.00586671},
                                   {-0.09489392, 0.04873062, -0.14809279, 0.05798735, -0.00095072, 0.07524196,
                                    -0.22849363, 0.19525401, 0.15070896, -0.04773715, 0.01720121, -0.11902821,
                                    0.03605046, 0.03483779, 0.11880589, -0.1271327, -0.09166399, 0.03405881,
                                    0.1757359, 0.08856047, 0.1930269, 0.11950576, -0.09733576, 0.23889422,
                                    -0.2690179, 0.1454651, -0.139183, 0.12071575, 0.18797901, -0.15911517,
                                    0.00453457, -0.1524636},
                                   {-0.2549769, 0.19793467, 0.2861283, 0.06203898, 0.05355598, 0.19424944,
                                    0.14889388, -0.14204848, 0.01696062, -0.14089166, 0.26137915, 0.04079394,
                                    -0.08010958, 0.12111629, -0.24560009, -0.24827033, -0.1698252, 0.04920503,
                                    0.00287033, 0.08771671, -0.03769875, 0.30384034, -0.08804061, -0.0630665,
                                    -0.30804658, 0.32158783, 0.19911005, 0.1339494, 0.24023199, 0.10679282,
                                    -0.03030897, 0.29854318},
                                   {-0.25900412, -0.08141868, 0.10706434, -0.03101063, 0.15022941, 0.15278311,
                                    0.21142907, 0.24441406, -0.02357793, -0.0332448, 0.1441117, 0.11695249,
                                    -0.05732358, 0.14735988, 0.09858623, -0.04851132, -0.17184216, -0.03235427,
                                    0.12511091, 0.02741504, -0.08607561, -0.1357076, -0.1689073, -0.0866411,
                                    0.12489092, -0.16691516, -0.22784495, -0.13779457, -0.19755645, -0.08285642,
                                    0.09481644, 0.11649561},
                                   {-0.14796314, 0.13552846, -0.04861154, 0.19721885, -0.12098627, -0.21622372,
                                    -0.15711085, -0.17487606, 0.05451788, 0.08497956, -0.02270512, -0.26107624,
                                    0.03298724, -0.05209485, -0.03612282, -0.15176721, 0.1887458, -0.12333336,
                                    -0.2628802, 0.03225653, 0.09669259, 0.1400071, -0.02257602, -0.12358257,
                                    -0.13509539, -0.09150287, -0.09809285, -0.21138953, 0.23421486, -0.00829962,
                                    0.03503373, -0.11349828},
                                   {0.2316308, 0.09267492, 0.10436702, -0.12088484, -0.10676265, 0.09377439,
                                    -0.11758906, 0.06468888, 0.25196397, 0.06569402, 0.01969251, -0.09384038,
                                    -0.13870859, 0.01301154, -0.08755374, 0.02948978, -0.14154495, -0.07116857,
                                    0.05974213, -0.1355937, 0.08438109, -0.10316039, 0.15548718, 0.14325431,
                                    0.09461867, -0.05527998, 0.25557223, -0.12424111, -0.18327163, 0.0487684,
                                    0.21329877, 0.00597341},
                                   {-0.02182305, 0.13534859, 0.18112488, 0.168552, -0.1974132, 0.09081282,
                                    -0.12364554, 0.18070726, 0.05718968, -0.20131399, -0.04204097, -0.13862215,
                                    -0.0098668, -0.04095934, -0.09043044, -0.02891323, -0.1709795, 0.11012547,
                                    -0.05180135, -0.08410127, -0.16937211, -0.06419163, -0.05620841, 0.14575504,
                                    0.1494024, 0.130285, -0.14829755, -0.14218181, 0.15397577, 0.17566141,
                                    -0.1232845, 0.14666437},
                                   {0.17287, 0.08101381, 0.03343531, 0.12960856, -0.09254631, 0.00426537,
                                    -0.19882376, 0.02708171, -0.18817091, 0.11496244, -0.10550124, -0.04995276,
                                    -0.19275579, 0.03576267, -0.00962441, -0.17198369, -0.06610195, 0.09534744,
                                    0.16552226, 0.1924487, 0.18040986, -0.00257789, 0.07308111, 0.2227591,
                                    -0.23314974, -0.18449576, -0.05307126, -0.00133188, -0.09211885, 0.11947415,
                                    -0.23156498, -0.24811277},
                                   {0.01609449, -0.09812129, 0.00716437, -0.06381071, 0.05924829, -0.08727587,
                                    -0.16454712, 0.09149483, -0.15573654, 0.13470669, 0.20697749, 0.03597723,
                                    -0.14384711, 0.12803411, -0.11729857, 0.18422751, 0.12957619, -0.02769575,
                                    0.09395663, 0.18265729, 0.05082762, 0.1314469, 0.03280428, -0.24268973,
                                    -0.1029622, 0.16959125, 0.1615501, -0.07116263, -0.06689064, 0.22888307,
                                    0.06272815, 0.11643023},
                                   {-0.14850587, 0.06146434, 0.18589607, -0.2715913, 0.13279718, 0.01916909,
                                    -0.17710768, 0.11424392, 0.01072252, -0.2533911, -0.0435547, -0.03657637,
                                    -0.23507296, 0.26083106, 0.09290047, -0.15615274, -0.05001685, -0.23347865,
                                    0.06928203, 0.25483987, -0.0108809, 0.07519701, 0.12368408, 0.10611898,
                                    0.04358672, 0.12121437, -0.02007486, 0.077626, 0.33793822, -0.2329587,
                                    -0.06977378, 0.19895464},
                                   {0.00509957, -0.28925315, 0.15130346, -0.282516, -0.18353498, 0.30387706,
                                    -0.09156066, 0.12706883, -0.1747638, -0.02703129, 0.27178714, -0.2738843,
                                    -0.0763379, 0.21720365, 0.1152103, -0.15999223, -0.1108137, -0.06841192,
                                    -0.10280838, 0.22580153, -0.2325349, 0.19320352, -0.19497456, -0.00130101,
                                    -0.07243749, 0.11211771, 0.33455676, -0.14954303, 0.25710273, -0.10637683,
                                    -0.19805954, 0.13682097},
                                   {-0.12235401, -0.16796128, -0.19869685, -0.02390296, 0.12482007, -0.12340298,
                                    -0.16936187, -0.23808263, -0.12412369, -0.14521398, -0.02266826, -0.12696235,
                                    -0.13227093, 0.01267551, 0.02172649, 0.04469011, 0.19034459, -0.20954509,
                                    -0.1775684, 0.03087358, 0.07032387, 0.0565839, 0.11760226, 0.01197784,
                                    0.09696425, -0.1747773, 0.03676606, -0.07399004, 0.20618753, 0.20060636,
                                    0.17863381, 0.07944645},
                                   {0.00031429, 0.08977409, 0.12814239, -0.19435933, -0.14577343, 0.04364326,
                                    0.12736502, 0.04459175, -0.09768867, -0.10069318, -0.16287182, 0.19151331,
                                    0.07464173, 0.08544427, -0.00514989, -0.10927156, -0.19504464, -0.11626445,
                                    -0.12694278, 0.00229349, -0.1941085, -0.06312308, -0.21708581, -0.04612876,
                                    0.00548636, -0.21144077, 0.03978327, 0.14183077, 0.18473293, -0.00147591,
                                    0.2647222, 0.14995906},
                                   {-0.14017591, -0.04295102, 0.06050786, 0.08575244, 0.13772774, 0.05411291,
                                    0.16351299, -0.23141019, 0.03132955, -0.05851593, -0.01286586, -0.12002485,
                                    -0.09017601, -0.09074838, -0.11739372, 0.14966275, 0.0268484, 0.08410572,
                                    -0.07272372, 0.13021766, 0.00271249, -0.12220769, 0.1813077, 0.25189078,
                                    0.07680218, -0.22456133, 0.27881134, -0.11990943, -0.01378068, -0.10238492,
                                    0.25375497, -0.18802615},
                                   {-0.04945769, 0.14591388, 0.22188608, 0.14671141, -0.02623091, -0.13644555,
                                    0.22149014, -0.01945352, 0.11340003, -0.00748055, 0.12158228, -0.06616342,
                                    0.0715785, -0.02122148, 0.11260912, -0.13093176, -0.15966919, -0.01652399,
                                    0.1604291, 0.0117746, -0.06733347, -0.27109167, -0.04188982, -0.1998659,
                                    -0.20441124, -0.1642311, 0.15758671, 0.05556883, -0.0463074, -0.12336234,
                                    0.10007053, -0.1484773},
                                   {0.04970554, -0.22118203, -0.02628236, 0.16157013, -0.17216773, -0.02971736,
                                    0.01619533, -0.00570293, 0.07261491, -0.16774808, 0.0198961, -0.20893049,
                                    -0.08747829, 0.04989533, 0.11130052, 0.11633182, -0.08161747, 0.137947,
                                    -0.1642998, 0.17747732, -0.23241717, -0.11923287, 0.09603963, 0.04001582,
                                    -0.15279001, 0.27437103, -0.23038176, 0.0374826, 0.14672913, 0.10551279,
                                    -0.211785, -0.15321904},
                                   {0.09069585, -0.23487732, 0.12850711, -0.16589095, 0.16356388, -0.20880257,
                                    0.10240828, 0.10125501, -0.08525927, -0.24062197, 0.06525581, 0.02836728,
                                    0.00872531, 0.09419147, -0.08229554, -0.00334395, 0.01473441, -0.03520138,
                                    -0.06848694, -0.05627003, 0.07370636, -0.20881309, -0.23512366, 0.07124426,
                                    -0.08562288, 0.06891128, -0.16911119, -0.23804905, 0.13820949, 0.18786822,
                                    0.20556398, 0.16822483},
                                   {0.15564637, 0.0390578, -0.1991387, -0.0945616, 0.16944988, -0.11010217,
                                    -0.08638945, 0.07710299, -0.08142797, -0.19450787, -0.0022381, 0.15080427,
                                    -0.19841869, -0.13835926, 0.14744265, 0.02419715, -0.12726508, 0.04844729,
                                    0.15341708, 0.14250022, -0.06958894, -0.17976055, -0.27016953, -0.09280612,
                                    0.19991265, -0.03755177, 0.08761315, -0.16548559, -0.17820244, 0.04590551,
                                    0.09990575, 0.11467513},
                                   {-0.10357011, -0.01745318, 0.12199831, 0.22175147, -0.13569866, 0.1439262,
                                    0.08425411, -0.20979409, 0.04160889, 0.12391564, 0.13796246, -0.09901527,
                                    0.06948936, -0.10287901, 0.17828035, -0.08156032, 0.21338746, 0.09952436,
                                    0.15227853, -0.01222401, -0.14486745, 0.04466985, 0.07698476, -0.09887267,
                                    -0.05223094, -0.16501336, -0.08635034, 0.12356072, -0.1171368, 0.11688513,
                                    0.03409149, 0.06301309},
                                   {0.22711371, 0.10053429, 0.14527558, -0.09523633, -0.09220024, -0.16394676,
                                    0.19610903, 0.14352612, 0.00550078, -0.17925406, -0.17721097, 0.2051022,
                                    -0.24022858, 0.2503082, 0.07741584, 0.02808334, 0.05082896, 0.11695117,
                                    0.0426807, -0.2109569, -0.11047383, 0.16366383, -0.17271198, 0.05796092,
                                    -0.11764929, -0.04240115, -0.00140697, 0.21669737, -0.13359404, 0.2526962,
                                    0.07360385, 0.22176601},
                                   {-0.05772403, -0.2391524, 0.05219082, -0.07211523, -0.25768283, 0.2121989,
                                    -0.06018326, 0.01506275, -0.02287778, 0.20218894, 0.30011263, 0.04368893,
                                    0.07549945, 0.1134494, 0.00865315, 0.12915088, 0.05176358, -0.01376636,
                                    0.13298583, -0.1440281, -0.15665059, 0.12659353, -0.17652917, -0.11416833,
                                    0.13309416, 0.01592479, -0.03801282, -0.07819262, 0.08352586, 0.15369253,
                                    -0.13458659, 0.0821888}};

  double biases_layer2[32] = {-0.06435797,
                              -0.07185807,
                              -0.02725856,
                              -0.0133632,
                              -0.0194589,
                              -0.02638065,
                              0.06429736,
                              -0.00198637,
                              -0.04300344,
                              0.02449394,
                              -0.01005452,
                              -0.04600397,
                              0.01222676,
                              -0.01407678,
                              0.00253272,
                              0.03236717,
                              -0.01097316,
                              -0.00574977,
                              -0.0192103,
                              -0.07018621,
                              -0.02774413,
                              0.03765062,
                              -0.07691738,
                              -0.08102001,
                              -0.06987914,
                              -0.04550583,
                              -0.08035424,
                              -0.03243718,
                              -0.03962424,
                              0.02636947,
                              -0.03615134,
                              -0.02270743};
  double weights_output[32][1] = {{0.17169383},
                                  {0.3042493},
                                  {0.37008294},
                                  {-0.193251},
                                  {-0.26279902},
                                  {0.28945962},
                                  {-0.0509518},
                                  {-0.24918048},
                                  {0.03047642},
                                  {-0.0364306},
                                  {0.00755879},
                                  {-0.23533368},
                                  {-0.11202905},
                                  {0.2350504},
                                  {-0.32360217},
                                  {-0.38490513},
                                  {-0.04280148},
                                  {-0.3106909},
                                  {-0.28352457},
                                  {0.18047613},
                                  {0.15849425},
                                  {0.13041528},
                                  {-0.33811185},
                                  {0.14497891},
                                  {-0.30916244},
                                  {0.33520126},
                                  {0.15152158},
                                  {-0.36512372},
                                  {0.24695598},
                                  {-0.09961078},
                                  {0.23335148},
                                  {0.11000933}};

  double bias_output[1] = {-0.05748596};

  double layer1[64];
  for (int i = 0; i < 64; ++i)
  {
    layer1[i] = 0;
    for (int j = 0; j < NUM_FEATURES; ++j)
    {
      layer1[i] += input[j] * weights_layer1[j][i];
    }
    layer1[i] += biases_layer1[i];
    layer1[i] = relu(layer1[i]);
  }

  double layer2[32];
  for (int i = 0; i < 32; ++i)
  {
    layer2[i] = 0;
    for (int j = 0; j < 64; ++j)
    {
      layer2[i] += layer1[j] * weights_layer2[j][i];
    }
    layer2[i] += biases_layer2[i];
    layer2[i] = relu(layer2[i]);
  }

  double output = 0;
  for (int i = 0; i < 1; ++i)
  {
    output = 0;
    for (int j = 0; j < 32; ++j)
    {
      output += layer2[j] * weights_output[j][i];
    }
    output += bias_output[i];
    output = sigmoid(output);
  }
  return output;
}
void print_peaks(int peaks[], int num_peaks)
{
  for (int i = 0; i < num_peaks; i++)
  {
    printf("%d,", peaks[i]);
  }
  nl;
}
void standard_scaler(double data[], double mean[], double std_dev[], int n)
{
  for (int i = 0; i < n; ++i)
  {
    data[i] = (data[i] - mean[i]) / std_dev[i];
  }
}

int classifier_scaler(double input[])
{

  double mean_values[] = {3.44774612e-01, -5.62257987e-03, 1.96760935e-01, 4.27192850e-01,
                          -1.91473912e-02, -6.80749281e-01, 9.88167708e+00, -9.77883763e+00,
                          -7.30664620e+00, 3.43032846e-01};

  double std_values[] = {0.64835712, 0.05070731, 0.02264315, 0.07268148, 0.16118912, 0.10383528,
                         6.45773827, 5.96363865, 3.62530811, 0.15975085};

  standard_scaler(input, mean_values, std_values, NUM_FEATURES);

  double prediction = classifier_predict(input);
  int final_pred = prediction > 0.5 ? 1 : 0;

  return final_pred;
}

float avG = 0;
double frate = 0.95;


static void filter(const double b[5], const double a[5], const double x[174], const double zi[4], double y[174])
{
  int k;
  int naxpy;
  int j;
  double as;
  for (k = 0; k < 4; k++)
  {
    y[k] = zi[k];
  }

  memset(&y[4], 0, 170U * sizeof(double));
  for (k = 0; k < 174; k++)
  {
    naxpy = 174 - k;
    if (!(naxpy < 5))
    {
      naxpy = 5;
    }

    for (j = 0; j + 1 <= naxpy; j++)
    {
      y[k + j] += x[k] * b[j];
    }

    naxpy = 173 - k;
    if (!(naxpy < 4))
    {
      naxpy = 4;
    }

    as = -y[k];
    for (j = 1; j <= naxpy; j++)
    {
      y[k + j] += as * a[j];
    }
  }
}

static void filtfilt(const double x_in[150], double y_out[150])
{
  double xtmp;
  double d1;
  int i;
  double y[174];
  double b_y[174];
  double a[4];
  static const double b_a[4] = {-0.19377359529033994, -0.1937735952902776,
                                0.19377359529029725, 0.19377359529031876};

  static const double dv1[5] = {0.19377359529031332, 0.0, -0.38754719058062664,
                                0.0, 0.19377359529031332};

  static const double dv2[5] = {1.0, -2.342095632660552, 1.9477115412319015,
                                -0.80784671655553675, 0.20433295072565855};

  xtmp = 2.0 * x_in[0];
  d1 = 2.0 * x_in[149];
  for (i = 0; i < 12; i++)
  {
    y[i] = xtmp - x_in[12 - i];
  }

  memcpy(&y[12], &x_in[0], 150U * sizeof(double));
  for (i = 0; i < 12; i++)
  {
    y[i + 162] = d1 - x_in[148 - i];
  }

  for (i = 0; i < 4; i++)
  {
    a[i] = b_a[i] * y[0];
  }

  memcpy(&b_y[0], &y[0], 174U * sizeof(double));
  filter(dv1, dv2, b_y, a, y);
  for (i = 0; i < 87; i++)
  {
    xtmp = y[i];
    y[i] = y[173 - i];
    y[173 - i] = xtmp;
  }

  for (i = 0; i < 4; i++)
  {
    a[i] = b_a[i] * y[0];
  }

  memcpy(&b_y[0], &y[0], 174U * sizeof(double));
  filter(dv1, dv2, b_y, a, y);
  for (i = 0; i < 87; i++)
  {
    xtmp = y[i];
    y[i] = y[173 - i];
    y[173 - i] = xtmp;
  }

  memcpy(&y_out[0], &y[12], 150U * sizeof(double));
}

struct features
{
  /* data */
  double hr;
  double ref_find;
  double sys_time;
  double foot_time;
  double lasi;
  double crest_time;
  double mnpv;
  double pir;
  double aix;
  double pulse_height;
  double pulse_width;
  double hrv;
  double amplitude_ratios;
  double max_amplitude;
  double min_amplitude;
  double womersley_number;
  double alpha;
  double ipa;
  double pwv;
  double sys_time_x;
};

void ic(int peaks[], int n)
{
  printf("\n");
  for (int i = 0; i < n; i++)
  {
    printf("%d,", peaks[i]);
  }
  printf("\n");
}


void find_systolic_peaks(double ppg_signal[150], int sys_peaks[], int *num_peaks, double filtered_ppg[150])
{
  double dv0[150];
  filtfilt(ppg_signal, dv0);
  for (int i = 0; i < 150; i++)
  {
    filtered_ppg[i] = dv0[i];
    // printf("%f,", filtered_ppg[i]);
  }
  // nl;

  int tol = 1, ppg_len = 150;
  for(int index = 0;index < ppg_len;){
    int idx = index;
    while (idx + 1 < ppg_len && filtered_ppg[idx] >= filtered_ppg[idx + 1])
    {
      idx++;
    }
    if (idx >= ppg_len - 1)
    {
      break;
    }
    while (idx + 1 < ppg_len && filtered_ppg[idx] <= filtered_ppg[idx + 1])
    {
      idx++;
    }
    if (idx != index)
    {
      sys_peaks[(*num_peaks)++] = idx;
      index = idx;
    }
    else
    {
      index++;
    }
  }
}

int min(int a, int b)
{
  return a < b ? a : b;
}
int max(int a, int b)
{
  return a > b ? a : b;
}

void print_features(struct features features)
{

  printf("Printing from print_features()\n");

  printf("alpha: %f\n", features.alpha);
  printf("amplitude ratios: %f\n", features.amplitude_ratios);
  printf("augmentation index: %f\n", features.aix);
  printf("crest_time: %f\n", features.crest_time);
  printf("foot time: %f\n", features.foot_time);
  printf("heart rate: %f\n", features.hr);
  printf("hrv: %f\n", features.hrv);
  printf("ipa: %f\n", features.ipa);
  printf("lasi_area: %f\n", features.lasi);
  printf("max_amplitude: %f\n", features.max_amplitude);
  printf("min_amplitude: %f\n", features.min_amplitude);
  printf("mnpv: %f\n", features.mnpv);
  printf("pir: %f\n", features.pir);
  printf("pulse_height: %f\n", features.pulse_height);
  printf("pulse_width: %f\n", features.pulse_width);
  printf("pwv: %f\n", features.pwv);
  printf("ref_ind: %f\n", features.ref_find);
  printf("sys_time: %f\n", features.sys_time);
  printf("sys time x: %f\n", features.sys_time_x);
  printf("wom_number: %f\n", features.womersley_number);
}

double find_heart_rate(int sys_peaks[], int num_peaks, double fs, int foot[])
{

  double peak_intervals[num_peaks - 1];
  for (int i = 1; i < num_peaks; i++)
  {
    peak_intervals[i - 1] = (double)(sys_peaks[i] - sys_peaks[i - 1]) / fs;
  }

  double heart_rates[num_peaks - 1];
  for (int i = 0; i < num_peaks - 1; i++)
  {
    heart_rates[i] = 60.0 / peak_intervals[i];
  }

  double sum = 0.0;
  for (int i = 0; i < num_peaks - 1; i++)
  {
    sum += heart_rates[i];
  }
  double average_heart_rate = sum / (num_peaks - 1);

  return average_heart_rate;
}
double find_refliction_index(double *ppg_bwr, int n, int *sys_peaks, int num_peaks)
{
  int inflection_peak[num_peaks];
  int inflection_count = 0;
  int tol = 1;

  for (int i = 0; i < num_peaks; i++)
  {
    int peak = sys_peaks[i];
    int idx = peak;

    while (idx + 1 < n && ppg_bwr[idx] >= ppg_bwr[idx + 1])
    {
      idx++;
    }
    // printf("before: %d, after: %d\n",sys_peaks[i],idx);
    if (idx != peak && abs(idx - peak) >= tol)
    {
      inflection_peak[inflection_count++] = idx;
    }
  }

  double numerator = 0.0;
  double denominator = 0.0;

  for (int i = 0; i < inflection_count; i++)
  {
    numerator += ppg_bwr[inflection_peak[i]];
    denominator += ppg_bwr[sys_peaks[i]];
  }

  double refliction_index = numerator / denominator;
  return refliction_index;
}
double trapezoidal_area(double *ppg, int n, int start_index, int end_index, double sampling_interval)
{
  double area = 0.0, div = 2 * sampling_interval;
  for (int i = start_index; i < end_index; i++)
  {
    double a = ppg[i] < 0 ? -ppg[i] : ppg[i];
    double b = ppg[i+1] < 0 ? -ppg[i+1] : ppg[i+1];
    // area += ((ppg[i] + ppg[i + 1]) / div);
    area += ((a + b)/div);
  }
  return area;
}

double find_lasi(double *ppg, int sys_peaks[], int num_peaks, double fs, int foot[])
{


  // ic(sys_peaks,num_peaks);
  // ic(foot,num_peaks);

  int n = 150;
  int s3[num_peaks];
  int s3_idx = 0;
  for (int i = 0; i < num_peaks - 1; i++)
  {
    s3[s3_idx++] = (int)(sys_peaks[i] + foot[i + 1]) / 2;
  }

  // ic(s3,num_peaks-1);
  
  double s2[num_peaks];
  for (int i = 0; i < num_peaks; i++)
  {
    s2[i] = sys_peaks[i];
  }
  double sampling_interval = 1 / fs, area = 0.0;
  for (int i = 0; i < num_peaks - 1; i++)
  {
    int s2_index = s2[i];
    int s3_index = s3[i];
    area += trapezoidal_area(ppg, n, min(s2_index, s3_index), max(s2_index, s3_index), sampling_interval);
  }
  area /= num_peaks;
  return area;
}
double find_crest_time(double *ppg, int sys_peaks[], int num_peaks, double fs, int foot[])
{

  double crest_time = 0;
  int div = 0;
  for (int i = 0; i < num_peaks; i++)
  {
    div++;
    crest_time += ((sys_peaks[i] - foot[i]) / fs);
  }
  crest_time /= div;
  return crest_time;
}
double find_mnpv(double *ppg, int sys_peaks[], int num_peaks, double fs, int foot[])
{
  // sys_peaks, _ = find_peaks(ppg_signal, prominence=0.3, distance=15)
  double iac = 0;
  int div = 0;
  for (int i = 1; i < num_peaks; i++)
  {
    iac += (ppg[i] - ppg[i - 1]) / fs;
    div++;
  }
  iac /= div;
  double peak_intervals[num_peaks - 1];
  for (int i = 1; i < num_peaks; i++)
  {
    peak_intervals[i - 1] = (double)(sys_peaks[i] - sys_peaks[i - 1]) / fs;
  }
  double sum_intervals = 0.0;
  for (int i = 0; i < num_peaks - 1; i++)
  {
    sum_intervals += peak_intervals[i];
  }

  double average_interval = sum_intervals / (num_peaks - 1);

  double result = iac / (iac + average_interval);
  return result;
}
double find_foot_time(double *ppg, int sys_peaks[], int num_peaks, double fs, int foot[])
{

  double foot_time = 0;
  for (int i = 0; i < num_peaks - 1; i++)
  {
    foot_time += ((foot[i + 1] - sys_peaks[i]) / fs);
  }
  foot_time /= (num_peaks - 1);
  return foot_time;
}
double find_sys_time(double *ppg, int sys_peaks[], int num_peaks, double fs, int foot[])
{

  double foot_time = 0;
  for (int i = 0; i < num_peaks; i++)
  {
    foot_time += (sys_peaks[i] - foot[i]) / fs;
  }
  foot_time /= num_peaks;
  return foot_time;
}
double find_pir(double *ppg, int sys_peaks[], int num_peaks, double fs, int foot[])
{

  // ic(sys_peaks,num_peaks);
  // ic(foot,num_peaks);

  double new_ppg[150];
  for (int i = 0; i < 150; i++)
  {
    new_ppg[i] = ppg[i];
  }

  double pir = 0;
  for (int i = 0; i < num_peaks; i++)
  {
    pir += (new_ppg[sys_peaks[i]] / new_ppg[foot[i]]);
  }
  pir /= num_peaks;
  pir -= 3.0;
  return pir;
}

double find_max_amplitude(double *ppg, int ppg_len, int foot[])
{
  double max_ppg_val = ppg[0];
  for (int i = 1; i < ppg_len; i++)
  {
    if (ppg[i] > max_ppg_val)
    {
      max_ppg_val = ppg[i];
    }
  }
  return max_ppg_val;
}

double find_min_amplitude(double *ppg, int ppg_len, int foot[])
{
  double min_ppg_val = ppg[0];
  for (int i = 1; i < ppg_len; i++)
  {
    if (ppg[i] < min_ppg_val)
    {
      min_ppg_val = ppg[i];
    }
  }
  return min_ppg_val;
}

void print_sys_peaks(int sys_peaks[], int num_peaks)
{
  printf("printing sytolic peaks: ");
  for (int i = 0; i < num_peaks; i++)
  {
    printf("%d,", sys_peaks[i]);
  }
  printf("\n");
}

double find_augmentation_index(double *ppg, int ppg_len, int sys_peaks[], int num_peaks, int foot[])
{
  // print_sys_peaks(sys_peaks,num_peaks);
  double primary_peak = ppg[sys_peaks[0]];
  double reflected_peak = ppg[sys_peaks[1]];
  double augmentation_pressure = reflected_peak - primary_peak;
  // double max_ppg_val = find_max_amplitude(ppg, ppg_len), min_ppg_val = find_min_amplitude(ppg, ppg_len);

  double max_ppg_val = ppg[0], min_ppg_val = ppg[0];

  for (int i = 1; i < ppg_len; i++)
  {
    if (ppg[i] > max_ppg_val)
    {
      max_ppg_val = ppg[i];
    }
  }

  for (int i = 1; i < ppg_len; i++)
  {
    if (ppg[i] < min_ppg_val)
    {
      min_ppg_val = ppg[i];
    }
  }

  double pulse_pressure = max_ppg_val - min_ppg_val;
  double aix = augmentation_pressure / pulse_pressure;
  return aix;
}

double find_pulse_height(double *ppg, int sys_peaks[], int num_peaks, double fs, int foot[])
{

  double pulse_height = 0;
  for (int i = 0; i < num_peaks; i++)
  {
    pulse_height += (ppg[sys_peaks[i]] - ppg[foot[i]]);
  }
  pulse_height /= num_peaks;
  return pulse_height;
}
double find_pulse_width(double *ppg, int sys_peaks[], int num_peaks, double fs, int foot[])
{

  double pulse_width = 0;
  for (int i = 0; i < num_peaks - 1; i++)
  {
    pulse_width += ((foot[i] - foot[i + 1]) / fs);
  }
  pulse_width /= (num_peaks - 1);
  return pulse_width;
}

double find_hrv(double *ppg, int sys_peaks[], int num_peaks, int foot[])
{
  double ppi[num_peaks - 1];
  for (int i = 1; i < num_peaks; i++)
  {
    ppi[i - 1] = ppg[sys_peaks[i]] - ppg[sys_peaks[i - 1]];
    // printf("%f,", ppi[i - 1]);
  }
  // nl;
  double mean = 0.0, sum_deviation = 0.0;
  for (int i = 0; i < num_peaks - 1; i++)
  {
    mean += ppi[i];
  }
  mean /= (num_peaks - 1);
  for (int i = 0; i < num_peaks - 1; i++)
  {
    sum_deviation += (ppi[i] - mean) * (ppi[i] - mean);
  }
  double div = sum_deviation / (num_peaks - 1);
  double hrv = sqrt(div);
  return hrv > 1 ? 1 - hrv : hrv;
}
double find_amplitude_ratios(double *ppg, int sys_peaks[], int num_peaks, int foot[])
{
  double sys_peaks_amplitudes[num_peaks];
  double shifted_sys_peaks_amplitudes[num_peaks];

  for (int i = 0; i < num_peaks; i++)
  {
    sys_peaks_amplitudes[i] = ppg[sys_peaks[i]];
    shifted_sys_peaks_amplitudes[i] = ppg[sys_peaks[i]];
  }
  double tmp = shifted_sys_peaks_amplitudes[num_peaks - 1];
  for (int i = num_peaks - 1; i > 0; i--)
  {
    shifted_sys_peaks_amplitudes[i] = shifted_sys_peaks_amplitudes[i - 1];
  }
  shifted_sys_peaks_amplitudes[0] = tmp;
  double amplitude_ratios[num_peaks];
  for (int i = 0; i < num_peaks; i++)
  {
    amplitude_ratios[i] = sys_peaks_amplitudes[i] / shifted_sys_peaks_amplitudes[i];
  }
  double mean_amplitude_ratios = 0.0;
  for (int i = 1; i < num_peaks; i++)
  {
    mean_amplitude_ratios += amplitude_ratios[i];
  }
  mean_amplitude_ratios /= (num_peaks - 1);
  return mean_amplitude_ratios;
}
double find_womersley_number(double *ppg, int sys_peaks[], int num_peaks, int foot[])
{

  double mean = 0.0;
  for (int i = 0; i < num_peaks; i++)
  {
    mean += ppg[foot[i]];
  }
  mean /= num_peaks;
  return mean;
}


double find_alpha(double *ppg, int sys_peaks[], int num_peaks, int foot[])
{
  // print_peaks(sys_peaks,num_peaks);
  // print_peaks(foot,num_peaks);

  double alpha = 0;
  for (int i = 0; i < num_peaks - 1; i++)
  {
    alpha += (sys_peaks[i] - foot[i] - foot[i + 1]);
  }
  alpha /= num_peaks;
  return alpha;
}

double find_ipa(double *ppg, int ppg_len, int sys_peaks[], int num_peaks, double fs, int foot[])
{

  int s1[num_peaks];
  for (int i = 0; i < num_peaks; i++)
  {
    s1[i] = (sys_peaks[i] + foot[i]) / 2;
  }

  int s3[num_peaks - 1];
  for (int i = 0; i < num_peaks - 1; i++)
  {
    s3[i] = (sys_peaks[i] + foot[i + 1]) / 2;
  }

  int s4[num_peaks - 1];
  for (int i = 1; i < num_peaks; i++)
  {
    s4[i - 1] = foot[i];
  }

  int s2[num_peaks];
  for (int i = 0; i < num_peaks; i++)
  {
    s2[i] = sys_peaks[i];
  }

  double sampling_interval = 1 / fs;
  double area = 0.0, total = 0.0;
  for (int i = 0; i < num_peaks - 1; i++)
  {
    int s1_index = s1[i];
    int s2_index = s2[i];
    int s3_index = s3[i];
    int s4_index = s4[i];

    double area1 = trapezoidal_area(ppg, ppg_len, min(s1_index, s2_index), max(s1_index, s2_index), sampling_interval);
    double area2 = trapezoidal_area(ppg, ppg_len, min(s3_index, s4_index), max(s3_index, s4_index), sampling_interval);
    double ipa_ratio = (area2 != 0) ? (area1 / area2) : 0;

    if (ipa_ratio)
    {
      area += ipa_ratio;
      total++;
    }
  }

  // return area == 0 ? -1 : area;
  return area < 1 ? area-1 : area;
}
double find_pwv(double *ppg, int sys_peaks[], int num_peaks, double fs, int foot[])
{

  double time_add = 0.0;
  for (int i = 0; i < num_peaks; i++)
  {
    time_add += ((sys_peaks[i] - foot[i]) / fs);
  }
  double pwv = 1 / time_add;
  return pwv < 0 ? -pwv : pwv;
}
double find_systolic_time_x(double *ppg, int sys_peaks[], int num_peaks, double fs)
{

  int n = 150;
  // for (int i = 0; i < n / 2; i++)
  // {
  //   double temp = ppg[i];
  //   ppg[i] = ppg[n - 1 - i];
  //   ppg[n - 1 - i] = temp;
  // }

  int val = 35;
  double mul_fact = (double)val / 100.0;

  int foot[50];
  double sys_time = 0.0;
  int div = 0;
  for (int i = 0; i < num_peaks; i++)
  {
    int peak = sys_peaks[i];
    int idx = peak;

    while (idx >= 1 && ppg[idx] >= ppg[idx - 1])
    {
      idx--;
    }

    int add = idx + ceil(mul_fact * abs(peak - idx));

    foot[i] = add;
    if (peak != add)
    {
      div++;
      sys_time += ((ppg[peak] - ppg[add]) / fs);
    }
  }

  sys_time /= div;
  // printf("Systolic time: %f\n", sys_time);

  return sys_time;
}

void extract_features(double ppg[], double fs, int ppg_len, struct features *my_features)
{

  // double ppg[150] = {117,117,117,117,120,120,121,123,124,126,127,128,130,131,134,135,137,140,141,144,145,142,121,119,120,120,120,121,123,123,124,126,127,128,130,131,134,135,137,138,141,141,124,121,123,121,121,123,124,126,126,127,130,131,133,134,135,138,141,144,145,148,151,140,121,120,121,119,119,121,123,123,124,126,128,130,131,133,134,137,140,141,142,147,148,127,120,120,121,119,120,123,124,124,126,128,130,131,133,134,137,140,142,145,148,121,121,123,121,121,124,126,126,128,130,133,134,135,137,140,142,144,145,148,151,137,121,120,121,120,120,121,124,124,124,128,131,133,134,137,141,144,147,149,152,152,154,155,154,120};
  

  int start = 0;
  int end = ppg_len - 1;
  while (start < end)
  {
    double temp = ppg[start];
    ppg[start] = ppg[end];
    ppg[end] = temp;
    start++;
    end--;
  }

  int sys_peaks[50] = {};
  int num_peaks = 0;
  double filtered_ppg[150];
  find_systolic_peaks(ppg, sys_peaks, &num_peaks, filtered_ppg);
  int fin_sys_peaks[50];
  int fin_peak_count = 0;

  // use filtered ppg for extracting features
  double save_ppg[150];
  for (int i = 0; i < ppg_len; i++)
  {
    save_ppg[i] = ppg[i];
    ppg[i] = filtered_ppg[i];
  }
  // skip the last peak
  for (int i = 0; i < num_peaks - 1; i++)
  {
    int curr_peak = sys_peaks[i];
    while (curr_peak >= 1 && ppg[curr_peak] <= ppg[curr_peak - 1])
    {
      curr_peak--;
    }
    fin_sys_peaks[fin_peak_count++] = curr_peak;
  }
  // print_peaks(fin_sys_peaks,fin_peak_count);

  // foot peaks
  int foot[fin_peak_count];
  int foot_idx = 0;
  int n = 150;
  for (int i = 0; i < fin_peak_count; i++)
  {
    int idx = fin_sys_peaks[i];
    while (idx >= 1 && ppg[idx] >= ppg[idx - 1])
    {
      idx = idx - 1;
    }
    foot[foot_idx++] = idx;
  }

  // print_peaks(fin_sys_peaks,fin_peak_count);

  double heart_rate = find_heart_rate(fin_sys_peaks, fin_peak_count, fs, foot);
  my_features->hr = heart_rate;

  double ref_ind = find_refliction_index(ppg, ppg_len, fin_sys_peaks, fin_peak_count);
  my_features->ref_find = ref_ind;

  double lasi_area = find_lasi(ppg, fin_sys_peaks, fin_peak_count, fs, foot);
  my_features->lasi = lasi_area;

  double crest_time = find_crest_time(ppg, fin_sys_peaks, fin_peak_count, fs, foot);
  my_features->crest_time = crest_time;

  double mnpv = find_mnpv(ppg, fin_sys_peaks, fin_peak_count, fs, foot);
  my_features->mnpv = mnpv;

  double sys_time = find_sys_time(ppg, fin_sys_peaks, fin_peak_count, fs, foot);
  my_features->sys_time = sys_time;

  double foot_time = find_foot_time(ppg, fin_sys_peaks, fin_peak_count, fs, foot);
  my_features->foot_time = foot_time;

  double pir = find_pir(ppg, fin_sys_peaks, fin_peak_count, fs, foot);
  my_features->pir = pir;

  double aix = find_augmentation_index(ppg, ppg_len, fin_sys_peaks, num_peaks, foot);
  my_features->aix = aix;

  double pulse_height = find_pulse_height(ppg, fin_sys_peaks, fin_peak_count, fs, foot);
  my_features->pulse_height = pulse_height;

  double pulse_width = find_pulse_width(ppg, fin_sys_peaks, fin_peak_count, fs, foot);
  my_features->pulse_width = pulse_width;

  double hrv = find_hrv(ppg, fin_sys_peaks, fin_peak_count, foot);
  my_features->hrv = hrv;

  double amp_rat = find_amplitude_ratios(ppg, fin_sys_peaks, fin_peak_count, foot);
  my_features->amplitude_ratios = amp_rat;

  double max_amplitude = find_max_amplitude(ppg, ppg_len, foot);
  my_features->max_amplitude = max_amplitude;

  double min_amplitude = find_min_amplitude(ppg, ppg_len, foot);
  my_features->min_amplitude = min_amplitude;

  double wom_number = find_womersley_number(ppg, fin_sys_peaks, fin_peak_count, foot);
  my_features->womersley_number = wom_number;

  double alpha = find_alpha(ppg, fin_sys_peaks, fin_peak_count, foot);
  my_features->alpha = alpha;

  double ipa = find_ipa(ppg, ppg_len, fin_sys_peaks, fin_peak_count, fs, foot);
  my_features->ipa = ipa;

  double pwv = find_pwv(ppg, fin_sys_peaks, fin_peak_count, fs, foot);
  my_features->pwv = pwv;

  double sys_time_x = find_systolic_time_x(ppg, fin_sys_peaks, fin_peak_count, fs);
  my_features->sys_time_x = sys_time_x;
}

float firmware_ppg_filter(double a)
{
  double fir = (double)a;
  avG = avG * frate + fir * (1.0 - frate);
  float irG = (2.0 * fir - avG) / avG * scale;
  float b = (irG / 1);
  b = -(b * 10);
  b = b + 925;
  double y = (int)b;
  y = y * 1.4;
  y = y + 70;
  return (uint8_t)y;
}

typedef struct
{
  int input_dim;
  int output_dim;
  double **weights;
  double *biases;
} Layer;

// Allocate memory for a layer
Layer *create_layer(int input_dim, int output_dim)
{
  Layer *layer = (Layer *)malloc(sizeof(Layer));
  layer->input_dim = input_dim;
  layer->output_dim = output_dim;
  layer->weights = (double **)malloc(output_dim * sizeof(double *));
  for (int i = 0; i < output_dim; i++)
  {
    layer->weights[i] = (double *)malloc(input_dim * sizeof(double));
  }
  layer->biases = (double *)malloc(output_dim * sizeof(double));
  return layer;
}

// Free memory for a layer
void free_layer(Layer *layer)
{
  for (int i = 0; i < layer->output_dim; i++)
  {
    free(layer->weights[i]);
  }
  free(layer->weights);
  free(layer->biases);
  free(layer);
}

// Initialize weights and biases for a layer
void init_layer(Layer *layer, double weights[], double biases[])
{
  for (int i = 0; i < layer->output_dim; i++)
  {
    for (int j = 0; j < layer->input_dim; j++)
    {
      layer->weights[i][j] = weights[i * layer->input_dim + j];
    }
    layer->biases[i] = biases[i];
  }
}

// Perform the forward pass for a layer
void forward_layer(Layer *layer, double *input, double *output)
{
  for (int i = 0; i < layer->output_dim; i++)
  {
    output[i] = layer->biases[i];
    for (int j = 0; j < layer->input_dim; j++)
    {
      output[i] += layer->weights[i][j] * input[j];
    }
    output[i] = relu(output[i]);
  }
}

  Layer *layer1_reg;
  Layer *layer2_reg;
  Layer *layer3_reg;
  Layer *layer4_reg;


  

#define INPUT_DIM 10
#define NUM_NEURONS1 32
#define NUM_NEURONS2 16
#define NUM_NEURONS3 8

// Define the activation function (ReLU)
// double relu(double x) {
//     return x > 0 ? x : 0;
// }

// Function to perform matrix-vector multiplication
void mat_vec_mult(double *matrix, double *vector, double *result, int rows, int cols) {
  for (int i = 0; i < rows; i++)
  {
    result[i] = 0.0;
    for (int j = 0; j < cols; j++)
    {
      result[i] += matrix[i * cols + j] * vector[j];
    }
  }
}

// Define the neural network structure
typedef struct {
    double weights1[INPUT_DIM * NUM_NEURONS1];
    double biases1[NUM_NEURONS1];
    double weights2[NUM_NEURONS1 * NUM_NEURONS2];
    double biases2[NUM_NEURONS2];
    double weights3[NUM_NEURONS2 * NUM_NEURONS3];
    double biases3[NUM_NEURONS3];
    double weights4[NUM_NEURONS3 * 1];
    double biases4[1];
} NeuralNetwork;

// Function to set predefined weights and biases
void set_weights_and_biases(NeuralNetwork *nn, double *w1, double *b1, double *w2, double *b2, double *w3, double *b3, double *w4, double *b4) {
  for (int i = 0; i < INPUT_DIM * NUM_NEURONS1; i++)
  {
    nn->weights1[i] = w1[i];
  }
  for (int i = 0; i < NUM_NEURONS1; i++)
  {
    nn->biases1[i] = b1[i];
  }
  for (int i = 0; i < NUM_NEURONS1 * NUM_NEURONS2; i++)
  {
    nn->weights2[i] = w2[i];
  }
  for (int i = 0; i < NUM_NEURONS2; i++)
  {
    nn->biases2[i] = b2[i];
  }
  for (int i = 0; i < NUM_NEURONS2 * NUM_NEURONS3; i++)
  {
    nn->weights3[i] = w3[i];
  }
  for (int i = 0; i < NUM_NEURONS3; i++)
  {
    nn->biases3[i] = b3[i];
  }
  for (int i = 0; i < NUM_NEURONS3 * 1; i++)
  {
    nn->weights4[i] = w4[i];
  }
  nn->biases4[0] = b4[0];
  // printf("\nSetup done\n");
}

// Forward propagation
double forward(NeuralNetwork *nn, double *input) {
  double layer1[NUM_NEURONS1];
  double layer2[NUM_NEURONS2];
  double layer3[NUM_NEURONS3];
  double output[1];

  // Layer 1
  mat_vec_mult(nn->weights1, input, layer1, NUM_NEURONS1, INPUT_DIM);
  for (int i = 0; i < NUM_NEURONS1; i++)
  {
    layer1[i] = relu(layer1[i] + nn->biases1[i]);
  }

  // Layer 2
  mat_vec_mult(nn->weights2, layer1, layer2, NUM_NEURONS2, NUM_NEURONS1);
  for (int i = 0; i < NUM_NEURONS2; i++)
  {
    layer2[i] = relu(layer2[i] + nn->biases2[i]);
  }
  // Layer 3
  mat_vec_mult(nn->weights3, layer2, layer3, NUM_NEURONS3, NUM_NEURONS2);
  for (int i = 0; i < NUM_NEURONS3; i++)
  {
    layer3[i] = relu(layer3[i] + nn->biases3[i]);
  }

  // Output layer
  // mat_vec_mult(nn->weights4, layer3, output, 1, NUM_NEURONS3);

  output[0] = 0;
  for (int i = 0; i < NUM_NEURONS3; i++)
  {
    output[0] += nn->weights4[i] * layer3[i];
  }
  if (output[0] < 0)
  {
    printf("changing\n");
    output[0] = -output[0];
  }

  printf("before bias addition: %f\n", output[0]);
  output[0] += nn->biases4[0];
  printf("after bias addition: %f\n", output[0]);

  return output[0];
}

double predict_blood_pressure(double feature_vector[], double max_bp, double min_bp)
{
    NeuralNetwork nn;

    double layer1_weights_reg[INPUT_DIMENSION * NUM_NEURONS1] = {-0.3503994,-0.11415278,0.23711745,-0.019606477,0.27774414,0.025498033,0.14105412,0.22055733,0.10448018,-0.0829528,-0.31047115,0.08345437,-0.2187276,-0.05113656,-0.32387948,-0.07380569,-0.29556826,-0.16844663,0.035820358,-0.51384383,0.2899235,-0.39583772,-0.47996193,-0.27842724,0.1830109,-0.032885037,-0.12159767,0.38805917,0.29012612,-0.35034227,0.23113535,-0.31868607,
-0.21914348,0.35865512,0.050745603,-0.6785135,0.023577549,-0.3313989,-0.5200477,0.05381591,-0.27345008,-0.35118574,-0.19159205,0.0346654,-0.1432506,0.22374813,0.1950093,-0.1414255,0.13682143,0.123821415,0.2616941,-0.10893986,-0.26615554,0.20816225,-0.049556177,-0.10779534,-0.19514449,0.041040156,-0.47683132,-0.13964424,0.10686694,0.052745283,-0.5116828,0.27752486,
0.02935177,0.181043,0.2435806,0.26953766,-0.17548096,0.055259913,-0.31842855,0.22431612,-0.08628745,0.25965774,0.41247705,0.020816488,-0.1231802,-0.13645263,0.40105936,0.07779792,-0.11337389,0.27758273,0.11040675,0.37766254,-0.054322686,0.30603418,0.46715236,0.4797863,-0.17029528,-0.06383396,-0.3424076,-0.34639034,-0.35554227,-0.18063076,0.27270475,-0.2890643,
0.2833099,-0.39418438,0.3650957,-0.5302657,0.3515658,-0.18691799,-0.74895453,0.046045166,0.698484,0.16011599,0.3377564,-0.41614297,-0.042167254,-0.48817214,0.39386892,-0.00980112,0.17784056,-1.5423584,0.8341686,0.3554191,0.099115774,-0.096109,-0.24142835,0.051433258,-0.6593014,0.15197444,-0.53031474,-0.12946971,-0.019691473,-0.26783547,0.30168,-0.810416,
-0.23939177,0.12657689,-0.37485954,-0.26682177,0.3329877,-0.30548516,0.4776012,-0.27956957,0.18715885,-0.38903046,0.22931753,-0.5095737,-0.50310665,-0.00031214952,-0.160747,-0.330119,-0.3403831,-0.14659461,-0.25622517,-0.48880273,-0.35795176,0.49871376,0.059313547,-0.14025375,0.49797702,-0.25825146,0.18808118,0.08491554,-0.10819058,-0.19966649,0.48738334,0.23536159,
-0.08314544,-0.36082166,-0.15596089,-0.1216137,0.19577585,-0.047044694,0.12151882,-0.37260073,0.23365563,0.1169203,-0.0049017807,0.15162146,0.21393675,0.26334625,0.121073194,-0.2715824,0.34658185,0.15794449,0.17785627,0.20055772,-0.28598097,-0.16994494,-0.34823817,0.22421533,0.09844902,0.09956161,0.11258543,-0.12016524,-0.29204938,-0.07884908,-0.33092597,0.35394046,
-0.21131764,-0.09568709,-0.02600659,-0.280928,-0.21670729,0.122017175,-0.4735126,0.04399419,0.19341213,-0.9409837,-0.41480526,-0.5519152,-0.2251595,-0.19228835,-0.4766454,-0.20580468,0.079248436,-0.26036838,0.4305872,0.086371854,-0.033600487,0.09771037,0.39004558,-0.35531136,-0.1689089,0.49966562,0.49393895,-0.29393747,0.3139706,-0.070257455,-0.028947301,-0.017095972,
-0.26156554,0.040507127,0.03407621,0.15649913,-0.07960222,-0.36263892,0.3585328,0.22158127,0.09909761,0.10271124,0.35883057,0.3587282,0.05189831,-0.014554052,-0.056166977,0.2308751,-0.27900591,0.25303304,-0.35826412,-0.025112318,-0.02743986,-0.07254588,0.26419187,-0.2256239,-0.38084844,0.28521097,0.2854664,0.33908182,-0.25966716,-0.32913876,-0.085230276,0.28768715,
0.24650475,0.49872842,-0.35638812,-0.26527137,-0.11769103,-0.37165678,-0.2085398,0.22758584,0.5493606,-0.5403352,-0.34092087,-0.0003373516,0.48720473,0.35635212,0.3797153,0.14876905,-0.14215851,-0.26304543,0.003154688,-0.051290143,0.11477822,0.39778408,-0.12085029,0.10692846,0.20673421,0.43820852,0.20672846,-0.4071269,-0.32602784,-0.1090453,-0.038553677,-0.32382616,
0.24777004,-0.038165852,0.07990285,0.28842536,-0.22161187,0.2235789,-0.13059351,0.3496994,-0.50254864,-0.32499713,-0.1942507,0.39057922,0.18483362,-0.30687138,0.21726128,0.0628337,-0.3750844,0.1638616,0.30939734,-0.6041878,0.30941725,0.29429367,-0.34463078,-0.32872635,-0.10073326,-0.30604625,0.32185704,0.30778006,-0.082346,-0.14258806,0.2754371,0.40481216,
};
    double layer1_biases_reg[NUM_NEURONS1] = {0.0,0.01923277,0.021182956,0.018473558,-0.009527106,0.0,-0.027354721,0.06622082,0.020489637,0.043528657,0.025900997,-0.02121151,0.027345683,0.021671867,0.012099271,0.0,-0.0060015474,-0.08295155,-0.033940956,0.049552977,-0.018943828,0.008472244,0.091033585,0.011970163,-0.021866066,-0.047380473,-0.044639528,0.011316348,-0.010040644,0.0,-0.028202226,0.006482829};

    double layer2_weights_reg[NUM_NEURONS1 * NUM_NEURONS2] = {0.34514788,-0.18000464,-0.11764939,-0.029070795,-0.18236443,-0.029537112,-0.06282079,-0.23970902,0.30266544,0.33640954,0.055666625,0.34555468,-0.14872013,0.123309106,0.18933466,0.04772362,
-0.69417465,-0.40982226,-0.94339854,0.35305807,0.033833787,-0.27381352,-0.14515485,-0.64660853,-1.0524219,-0.37822327,0.176976,-0.050872352,-0.09979324,-0.32228464,0.6998903,0.25536996,
0.15671736,-0.012059411,-0.33738148,0.22198646,-0.2575153,0.023366855,0.20724565,-0.1752017,0.17678066,0.18290338,0.3916191,0.2732189,-0.14056918,-0.19687845,0.22741541,0.39466587,
0.27879256,-1.2490306,0.057193805,-0.116410136,0.49515554,-0.21510528,0.44294277,0.43375924,0.20946674,-0.44489694,0.18634418,-1.0943552,0.3045785,0.21846749,-0.75312865,-0.31673166,
0.07075364,0.23428805,0.1976627,0.18676502,0.088017344,0.41982025,0.17511874,-0.3012018,-0.06615547,0.11979952,-0.35793662,0.015082808,0.13473468,0.15014008,0.024320658,0.33775294,
-0.12291142,-0.022593409,0.2757332,0.18370226,0.05684361,-0.13093576,-0.1677351,-0.28723454,0.14879015,0.28916612,0.3464363,0.29417685,-0.2127052,0.011482745,-0.07978532,-0.31975195,
-0.27105305,-0.6285638,0.38924718,-0.14190678,-0.25102356,0.28059825,-0.51978725,-0.23525567,-0.23348576,0.062561534,-0.13695423,-0.50643545,-0.19116014,-0.22087546,-0.33353058,-0.26587355,
0.049351424,0.25465572,0.31942907,-0.26325905,-0.05640126,-0.065897144,-0.5460656,0.21280655,-0.008793992,0.063593954,0.37911534,-0.3717952,-0.042109247,0.14800096,-0.06413786,0.31716475,
0.4957004,0.22016796,0.03951345,-0.1668308,0.15817635,0.62875485,0.24822912,-0.1394241,0.3141147,0.12734611,-0.26586676,-0.6923324,0.26001307,-0.2847948,0.34421197,0.17399937,
-0.0040103327,-0.304953,-0.14254095,0.6341157,-0.2299447,0.064642906,0.32942566,-0.52343565,0.7291206,0.35591975,-0.25873718,0.050914273,0.2926052,0.28058472,0.25879112,0.5730864,
0.10909096,-0.17008592,0.40130278,0.28452486,0.05397369,-0.20038627,0.070880145,0.36653015,0.16515994,-0.02309414,-0.30166516,0.2424654,-0.206654,0.057401046,0.37041748,0.24239664,
-0.33513254,-0.050690554,-0.21032098,0.26915705,-0.2817981,0.2829276,-0.4160107,-0.087683134,-0.32656065,0.16824774,-0.15347199,0.0046671587,-0.2593496,0.13713636,-0.3615596,0.25071988,
-0.08300415,-0.61367035,-0.3443589,0.24804625,0.37346783,0.45889598,-0.6365425,0.044711668,0.6474788,-0.4762434,0.16735423,-0.17810701,0.1895856,0.10788706,-0.5110003,-0.24440882,
0.24566849,0.16521922,0.36889595,-0.021394538,0.15742123,0.34864414,0.44137198,-0.026633848,0.07005205,0.03782334,0.1854755,-0.39676887,-0.22341049,-0.2445815,0.12239828,-0.08037928,
0.16037424,0.23882428,0.081168205,0.25809142,0.3463021,0.2109777,0.024935605,0.37876037,-0.17282641,-0.25234243,-0.023955517,-0.18600869,-0.35984647,-0.2688231,0.15451117,0.21232627,
-0.06372073,-0.12850852,-0.24905044,0.084133714,0.10124937,0.1788204,0.045802504,-0.161999,0.26968208,0.09203902,0.22171643,-0.29766548,0.2603704,0.028001368,0.30261377,-0.035054624,
0.030682199,0.22321221,-0.21525128,0.0141208675,0.17595206,-0.13441844,-0.25211722,0.0008156605,0.00027504563,-0.32160792,-0.26183257,-0.27870348,0.096324,-0.27102262,0.09404103,-0.16864552,
0.19297296,-0.13261351,0.15569992,-0.18443243,0.09639922,-0.18176033,0.087251745,0.05228487,-0.2696275,-0.255855,0.26113692,0.13281818,0.24599436,0.0147292325,0.19836044,0.17986274,
0.25006473,0.09707724,-0.5131913,0.060614824,0.39507806,0.41533345,0.054206513,0.2511792,0.13152371,0.118379034,0.20260634,-0.0012049188,0.015236859,-0.35795268,0.050019413,0.024067622,
0.5525242,-1.0540739,-0.19088425,-0.4141053,0.34146917,0.7308221,0.4980497,0.25207636,0.83521026,0.17204475,-0.8100969,-0.049773753,-0.2662079,0.07319914,-0.64558154,-0.71913284,
-0.2305245,-0.20229717,-0.34757033,-0.17795306,-0.03459309,0.12239622,0.09395891,0.17839412,0.0934219,-0.27983442,-0.07631963,0.28672162,-0.03474906,0.0009843707,0.23244375,-0.32500008,
0.16662528,-0.376263,-0.26991525,0.3753427,-0.0819969,-0.04617164,0.23836501,-0.124659546,-0.5789855,-0.97923154,-0.30173105,-0.3858207,-0.25843692,0.3050122,0.33492795,-0.2508528,
-1.0011532,1.0078909,-0.7219649,0.6882687,-0.70214194,0.44384745,-0.34740457,-1.0483179,0.21514016,-0.40486524,0.62191,-0.14124648,-0.014113665,0.14851232,1.1989594,0.9765332,
-0.47253177,-0.9142864,-0.34284803,0.12733348,-0.803703,-0.3084172,0.43675223,-0.5997386,0.26040283,0.5779523,-0.040736645,0.2663326,0.096839964,0.23909527,0.47713485,0.2651267,
0.57068336,-0.038217243,0.13189873,-0.40266174,0.201018,-0.03366458,-0.48089197,0.6292334,-0.14169206,-0.08223263,-1.6133679,0.5364543,0.21849576,-0.047512323,-0.39269066,-0.20586525,
-0.2542624,0.1268756,0.008742603,0.11677279,0.28492087,0.28174916,-0.15054725,-0.36714965,0.35773608,0.14341475,-0.2503738,-0.3930699,-0.29946178,-0.31546584,0.25135723,-0.39407933,
-0.0013749284,-0.22446795,-0.29063642,0.021133807,0.24091417,-0.18369508,0.21090604,-0.078399636,0.21526039,-0.31276086,0.23444048,0.27548474,-0.33938387,-0.19849065,-0.1356359,-0.29661748,
-0.02890455,-0.3036249,0.24210206,0.27271906,0.024424365,-0.19819301,-0.24615876,-0.523374,-0.36278898,-0.09289162,0.31969637,0.3196455,-0.08456233,-0.40584973,-0.20726018,0.028480314,
0.10423878,-0.09002125,-0.19006483,-0.15446217,0.12751019,-0.085139565,-0.26731682,0.25207618,-0.34665686,0.039424002,-0.18992676,-0.1869523,-0.08329296,-0.22631517,-0.14668104,-0.053282715,
0.25078925,-0.2772471,-0.043207437,0.18000928,0.30172542,-0.33495188,0.32777217,0.071256906,0.3290138,-0.2152174,-0.18915142,0.17991224,-0.053474575,-0.2171731,0.1583592,0.097002745,
0.03346738,-1.0436383,-0.21628094,-0.6634833,0.51391304,-0.8142587,-0.35305074,0.77379686,-1.4723861,-0.0566457,-0.32577088,-0.42925254,0.14210398,0.266996,-1.2844355,-0.53585047,
0.23433924,-0.32035932,-0.33585936,-0.051035725,-0.30024755,0.1779301,0.2390178,0.27706933,-0.20291202,-0.44655892,0.29232094,0.3013894,0.10093403,-0.19943625,0.06251294,0.3041442,
};
    double layer2_biases_reg[NUM_NEURONS2] = {0.019005599,0.047484256,-0.005668765,0.030827887,-0.012262822,0.068540946,-0.02999707,0.00044050204,-0.06490317,0.023786224,0.04482097,0.0048927404,-0.0076327994,-0.049126677,0.013751429,0.032654274};

    double layer3_weights_reg[NUM_NEURONS2 * NUM_NEURONS3] = {0.33762398,-0.3324992,0.07271413,0.18190984,0.43940115,-0.13226454,-0.22265269,0.25610065,
0.4770831,-0.341154,0.86999404,-1.3468746,-1.1915606,-0.5006643,-0.03014183,-1.1696694,
-0.3250864,-0.04902807,-0.6978048,0.68640614,0.27205926,0.38536137,-0.26225662,0.224591,
0.50138235,-0.054434262,0.4521877,-0.06347316,-0.1502579,0.1828444,0.052661415,0.22835788,
-0.025098788,0.021455413,-0.10961007,-0.30237684,0.15026644,0.5224768,0.34674937,0.009292078,
0.197604,0.26987273,0.50443476,0.24346794,0.45011726,0.1236927,-0.077668846,0.48267224,
0.023759967,0.112306096,0.03653497,0.078718394,-0.087449424,-0.76525986,0.10320031,0.3267357,
0.04217927,-0.90947324,-0.7637396,0.8610761,0.16662772,0.39306158,-0.1954207,-0.08732925,
-1.2120535,0.6400667,-1.3709422,0.48566994,1.2858771,0.34234422,0.17519148,1.620385,
0.79551715,-0.68588996,0.817601,-0.5651052,-0.95689166,-0.06463506,0.4417051,-0.9745985,
0.35615835,-0.46732673,0.38501844,-0.11352151,-0.4694742,0.14931479,0.11984448,-0.7823086,
0.1633516,0.12309735,0.04695391,-1.1321234,-1.6019042,-1.4635494,0.45168895,-0.7355419,
0.14430779,-0.3318956,0.4640441,0.3328693,-0.062888615,0.41589046,-0.37819827,0.47946575,
-0.25768253,-0.16256464,-0.08294883,0.014747977,0.35790616,-0.17169487,-0.4516499,0.121072814,
0.20964965,0.25077415,0.38026062,-0.43324947,-0.016876832,-0.8954264,-0.3009717,0.16910376,
0.56313056,-0.44750258,0.5283086,0.2466137,-0.2084935,-0.10947465,-0.3621494,0.012507861,
};
    double layer3_biases_reg[NUM_NEURONS3] = {0.04235385,-0.099013545,0.049114943,-0.0034289882,0.011074878,0.057528045,-0.010209414,-0.041046407};

    double layer4_weights_reg[NUM_NEURONS3 * 1] = {0.26569203,-1.0173475,0.856848,-0.2436633,-0.92839056,-1.40913,0.000662483,-0.38142222};
    double layer4_biases_reg[1] = {0.051056743};

    set_weights_and_biases(&nn, layer1_weights_reg, layer1_biases_reg, layer2_weights_reg, layer2_biases_reg, layer3_weights_reg, layer3_biases_reg, layer4_weights_reg, layer4_biases_reg);
    double output = forward(&nn, feature_vector);

    // printf("got from call: %f\n",output);
    double bias = 12.0;
    double diff = max_bp - min_bp;
    double predicted_bp = output * diff + min_bp;
    // predicted_bp += bias;
    printf("\ncalculated output: %f\n", predicted_bp);
    return predicted_bp;
}


double regressor(double feature_vector[], double max_bp, double min_bp)
{
  // normalize_features(feature_vector); // for regression model min-max scaler is used
  
  double max_feat = feature_vector[0], min_feat = feature_vector[0];
  for (int i = 1; i < INPUT_DIMENSION; i++)
  {
    if (feature_vector[i] > max_feat)
    {
      max_feat = feature_vector[i];
    }
    if (feature_vector[i] < min_feat)
    {
      min_feat = feature_vector[i];
    }
  }

  for (int i = 0; i < INPUT_DIMENSION; i++)
  {
    feature_vector[i] = (feature_vector[i] - min_feat) / (max_feat - min_feat);
  }

  double prediction = predict_blood_pressure(feature_vector, max_bp, min_bp);
  return prediction;
}

void get_all_features(struct features f, double arr[20], int to_print)
{
  arr[0] = f.hr;
  arr[1] = f.ref_find;
  arr[2] = f.sys_time;
  arr[3] = f.foot_time;
  arr[4] = f.lasi;
  arr[5] = f.crest_time;
  arr[6] = f.mnpv;
  arr[7] = f.pir;
  arr[8] = f.aix;
  arr[9] = f.pulse_height;
  arr[10] = f.pulse_width;
  arr[11] = f.hrv;
  arr[12] = f.amplitude_ratios;
  arr[13] = f.max_amplitude;
  arr[14] = f.min_amplitude;
  arr[15] = f.womersley_number;
  arr[16] = f.alpha;
  arr[17] = f.ipa;
  arr[18] = f.pwv;
  arr[19] = f.sys_time_x;

  if (to_print)
  {
    for (int i = 0; i < 20; i++)
    {
      printf("arr[%d] = %.2f\n", i, arr[i]);
    }
  }
}

void send_features_to_bridge(double filtered_ppg_signal[]){
  int ppg_len = 150;
  printf("here");
  struct features feat;
  double fs = 26.0;
  extract_features(filtered_ppg_signal, fs, ppg_len, &feat);
  int num_features = 20;
  double feature_vector[20];
  get_all_features(feat, feature_vector, 0);
  for (int i = 0; i < num_features; i++)
  {
    printf("%f,", feature_vector[i]);
  }
}

// double get_solve(double feature_vector[])
// {
//   int is_high_ppg = classifier_scaler(feature_vector);
//   printf("is high ppg: %d\n", is_high_ppg);
//   double max_bp = 175, min_bp = 130;
//   double blood_pressure = regressor(feature_vector, max_bp, min_bp);
//   return blood_pressure;
// }


double get_blood_pressure(double filtered_ppg_signal[])
{
  int ppg_len = 150;
  struct features feat;
  double fs = 26.0;
  
  extract_features(filtered_ppg_signal, fs, ppg_len, &feat);
  double feature_vector[] = {feat.crest_time, feat.mnpv, feat.sys_time, feat.foot_time, feat.aix, feat.pulse_width, feat.max_amplitude, feat.min_amplitude, feat.womersley_number, feat.ipa};
  double max_bp = 175, min_bp = 130;
  double blood_pressure = regressor(feature_vector, max_bp, min_bp);
  printf("%d\n",blood_pressure);
}

int main()
{
  srand(time(NULL));
  double full_ppg_signal[350] = {};
  double filtered_ppg_signal[150] = {116,117,121,123,124,126,127,128,130,131,124,120,121,123,126,127,128,130,131,131,134,135,133,123,123,124,127,128,131,133,134,134,135,137,134,124,123,124,126,127,128,130,133,134,134,134,135,126,123,123,126,128,128,130,131,134,135,135,135,128,126,126,127,128,130,133,133,134,135,135,137,133,124,124,126,128,128,131,133,134,135,135,137,133,124,123,126,128,128,131,131,134,135,135,135,134,124,123,124,126,127,128,130,131,133,135,137,135,126,123,124,126,127,130,133,134,134,135,138,138,133,124,124,127,128,128,133,134,135,135,137,138,135,126,124,127,128,130,131,134,135,137,137,138,138,127,124,124,126,128};
  int ppg_len = 150, raw_values_coming = 0, ppg_index = 0;
  int cnt = 0;
  // for (int i = ppg_len; i < ppg_len + 150; i++)
  // {
  //   // cnt ++;
  //   filtered_ppg_signal[ppg_index++] = (double)firmware_ppg_filter(full_ppg_signal[i]);
  // }
  // send_features_to_bridge(filtered_ppg_signal);


  get_blood_pressure(filtered_ppg_signal);

  return 0;
}
// compile command: gcc -o neu neural.c rtGetInf.c rt_nonfinite.c sort1.c sortIdx.c rtGetNaN.c eml_setop.c
// run command: .\neu.exe
