#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <stdint.h>
#include <string.h>

#define MAX_PEAKS 1000
#define nl printf("\n")
int ampd(double *ppg_filt, int n, int final_peaks[])
{
    int max_len = 0;
    int global_peaks[MAX_PEAKS] = {0};
    int global_peaks_len = 0;

    for (int window_len = 3; window_len < n - 3; window_len++)
    {
        int store[MAX_PEAKS];
        int store_len = 0;

        for (int low = 0; low + window_len < n; low++)
        {
            int max_index = low;
            double max_ppg_val = ppg_filt[low];

            for (int j = low; j < low + window_len; j++)
            {
                if (ppg_filt[j] >= max_ppg_val)
                {
                    max_ppg_val = ppg_filt[j];
                    max_index = j;
                }
            }

            if (max_index >= 1 && max_index + 1 < n && ppg_filt[max_index] > ppg_filt[max_index - 1] && ppg_filt[max_index] > ppg_filt[max_index + 1])
            {
                int duplicate = 0;
                for (int k = 0; k < store_len; k++)
                {
                    if (store[k] == max_index)
                    {
                        duplicate = 1;
                        break;
                    }
                }

                if (!duplicate)
                {
                    store[store_len] = max_index;
                    store_len++;
                }
            }
        }

        if (store_len > max_len)
        {
            max_len = store_len;
            global_peaks_len = store_len;
            for (int i = 0; i < store_len; i++)
            {
                global_peaks[i] = store[i];
            }
        }
    }

    int improved_peaks[MAX_PEAKS] = {0};
    int improved_peaks_len = 0, amplitude_tolerance = 7;

    for (int i = 0; i < global_peaks_len; i++)
    {
        int peak = global_peaks[i];
        while (peak + 1 < n && ppg_filt[peak] < ppg_filt[peak + 1])
        {
            peak++;
        }
        if (ppg_filt[peak] >= amplitude_tolerance)
        {
            improved_peaks[improved_peaks_len++] = peak;
        }
    }

    int final_peaks_len = 0, tol = 7;
    final_peaks[final_peaks_len++] = improved_peaks[0];

    for (int i = 1; i < improved_peaks_len; i++)
    {
        if (improved_peaks[i] - final_peaks[final_peaks_len - 1] >= tol)
        {
            final_peaks[final_peaks_len++] = improved_peaks[i];
        }
    }

    return final_peaks_len;
}
void print_peaks(int peaks_array[], int n)
{
    printf("printing peaks\n");
    for (int i = 0; i < n; i++)
    {
        printf("%d,", peaks_array[i]);
    }
    nl;
    nl;
    nl;
    nl;
}

void print_signal(double signal_array[], int n)
{
    printf("printing signal\n");
    for (int i = 0; i < n; i++)
    {
        printf("%f,", signal_array[i]);
    }
    nl;
    nl;
    nl;
    nl;
}

void calculate_derivative(const double signal[], double derivative[], int length)
{
    for (int i = 1; i < length; i++)
    {
        derivative[i - 1] = signal[i] - signal[i - 1];
    }
}

// Function to find the Pulse Transit Time (PTT)
double find_ptt(double ppg_signal_1[], double ppg_signal_2[], int n, int *peak1, int *peak2, int *num_peaks)
{
    double fs = 200.0; // Sampling frequency

    // Calculate the first derivatives
    double diff_ppg_signal_1[n - 1];
    double diff_ppg_signal_2[n - 1];
    calculate_derivative(ppg_signal_1, diff_ppg_signal_1, n);
    calculate_derivative(ppg_signal_2, diff_ppg_signal_2, n);

    // Detect peaks in the derivative signals
    int final_peaks1[MAX_PEAKS] = {0};
    int final_peaks2[MAX_PEAKS] = {0};
    int final_peaks_len1 = ampd(diff_ppg_signal_1, n - 1, final_peaks1);
    int final_peaks_len2 = ampd(diff_ppg_signal_2, n - 1, final_peaks2);

    // Determine the minimum length for peak matching
    int min_length = (final_peaks_len1 < final_peaks_len2) ? final_peaks_len1 : final_peaks_len2;
    double average_ptt = 0.0;
    int peak_count = 0;

    // Initialize arrays to keep track of valid peaks
    int keep1[n - 1];
    int keep2[n - 1];
    for (int i = 0; i < n - 1; i++)
    {
        keep1[i] = 0;
        keep2[i] = 0;
    }
    for (int i = 0; i < final_peaks_len1; i++)
    {
        if (final_peaks1[i] != -1)
        {
            keep1[final_peaks1[i]]++;
        }
    }

    for (int i = 0; i < final_peaks_len2; i++)
    {
        if (final_peaks2[i] != -1)
        {
            keep2[final_peaks2[i]]++;
        }
    }

    // Find the valid range for peak matching
    int start = 0, end = n - 2;
    int tol = 5;

    for (int i = tol; i < n - 1; i++)
    {
        if (keep1[i] && keep2[i])
        {
            start = i;
            break;
        }
    }

    for (int i = start; i < n - 1; i++)
    {
        if (keep1[i] && keep2[i] && i < min_length - tol)
        {
            end = i;
        }
    }

    // Calculate PTT using matched peaks
    for (int i = 0; i < min_length; i++)
    {
        int peak1_val = final_peaks1[i];
        int peak2_val = final_peaks2[i];

        if (peak1_val != -1 && peak2_val != -1)
        {
            peak1[peak_count] = peak1_val;
            peak2[peak_count] = peak2_val;

            double peak_diff = fabs((double)(peak1_val - peak2_val)) / fs;
            average_ptt += peak_diff;
            peak_count++;
        }
    }

    if (peak_count > 0)
    {
        average_ptt /= peak_count;
        printf("ptt from C: %f\n",average_ptt);
        *num_peaks = peak_count;
        return average_ptt;
    }
    else
    {
        *num_peaks = 0;
        return -1;
    }
}

// int main()
// {

//     double ppg_signal_1[] = {3997.01,3996.41,3992.2,3989.8,3989.11,3988.86,3986.34,3981.85,3977.23,3973.81,3970.58,3966.37,3961.99,3965.89,3984.02,3999.65,4007.35,4012.61,4013.46,4009.56,4004.92,4002.25,4001.47,3999.27,3995.35,3990.81,3986.52,3982.32,3978.97,3973.78,3970.46,3977.51,3997.2,4010.17,4017.43,4019.94,4018.33,4014.59,4012.11,4012.68,4011.67,4009.6,4006.37,4002.93,4000.07,3997.57,3993.21,3990.54,3996.85,4012.71,4025.16,4033.6,4037.63,4037.75,4033.61,4029.98,4029.19,4028.6,4025.95,4023.52,4019.55,4015.67,4010.5,4006.2,4002.44,4004.13,4020.05,4035.37,4045.33,4051.73,4052.75,4049.79,4044.94,4043.03,4040.68,4039.01,4037.52,4032.93,4030.13,4026.41,4022.24,4019.96,4028.05,4042.77,4053.18,4059.3,4062.99,4061.7,4055.67,4051.83,4050.45,4048.51,4046.26,4042.31,4039.36,4034.45,4031.35,4030.36,4042.54,4056.23,4063.87,4068.81,4069.71,4064.83,4058.4,4056.04,4053.18,4050.58,4046.24,4041.56,4036.04,4031.39,4026.15,4025.29,4039.74,4053.73,4061.45,4064.07,4063.23,4056.78,4050.81,4047.41,4045.55,4044.03,4040.16,4038.2,4035.46,4032.26,4029.66,4029.47,4043.81,4057.03,4064.79,4067.65,4067.34,4061.24,4056.44,4054.66,4052.77,4049.8,4046.12,4041.33,4037.61,4033.77,4028.67,4026.32,4035.55,4051.33,4062.53,4068.82,4069.38,4066.51,4060.93,4057.04,4055.2,4053.39,4049.16,4044.88,4040.12,4036.15,4031.85,4026.97,4026.8,4039.83,4054.57,4062.44,4067.02,4067.55,4061.98,4054.5,4050.68,4048.58,4045.61,4040.39,4035.2,4030.08,4024.83,4019.63,4014.21,4007.57,4007.34,4023.81,4041.25,4049.17,4052.59,4051.26,4045.71,4040.74,4039.73,4038.27,4034.64,4030.81,4025.36,4020.81,4016.89,4012.33,4008.15,4009.6,4024.67,4039.11,4046.01,4049.82,4049.18,4043.86,4039.28,4036.58,4034.42,4030.58,4025.98,4020.66,4015.06,4010.03,4004.22,3999.98,4001.32,4019.15,4035.47,4045.13,4049.12,4049.09,4045.05,4039.67,4036.42,4034.01,4030.48,4024.89,4019.66,4013.05,4007.19,4001.19,3995.47,3990.02,3987.22,4000.9,4020.66,4029.73,4033.3,4032.71,4026.78,4021.61,4018.77,4017.33,4017.25,4014.15,4011.67,4007.94,4005.9,4003.13,3999.08,3996.95,4009.26,4026.13,4036.3,4041.32,4043.94,4039.8,4034.81,4032.76,4029.25,4026.1,4022.95,4018.07,4014.81,4010.86,4006.61,4002.62,3999.49,4009.79,4026.72,4038.64,4045.71,4049.96,4048.87,4044.07,4039.89,4038.72,4036.33,4033.29,4028.13,4024.13,4018.63,4013.14,4007.05,4001.89,3998.06,4009.04,4026.93,4037.87,4044.54,4045.54,4040.48,4034.15,4027.54,4025.98,4022.42,4017.5,4010.79,4005.05,4001.35,3997.37,3992.98,3990.43,3997.35,4016.77,4030.98,4037.66,4039.77,4036.62,4032.15,4028.94,4027.13,4025.12,4022.11,4017.65,4012.13,4007.53,4003.41,3999.08,3993.28,3995.49,4013.17,4028.14,4036.1,4039.8,4039.71,4035.2,4030.65,4027.26,4025.31,4022.88,4018.77,4013.58,4008.59,4004.23,3999.27,3994.96,3990.13,3991.66,4008.77,4024.19,4033.13,4036.8,4036.59,4030.67,4025.19,4021.35,4018.49,4016.37,4010.78,4005.41,3997.2,3993.47,3989.13,3984.57,3979.23,3979.49,3996.72,4014.88,4023.25,4026.66,4023.74,4017.84,4014.07,4013.16,4011.7,4010.27,4006.11,4002.87,3999.09,3995.55,3993.09,3988.83,3985.52,3996.57,4015.48,4027.02,4032.49,4034.52,4031.34,4026.59,4023.33,4021.03,4018.3,4015.08,4010.96,4006.68,4002.87,3999.12,3994.45,3990.79,3994.62,4013.58,4028.7,4036.81,4041.97,4041.87,4037.09,4032.73,4030.36,4027.47,4023.2,4019.45,4014.58,4009.51,4004.97,4001.05,3996.54,3993.85,4002.99,4021.31,4033.28,4039.67,4042.85,4038.77,4033.67,4031.24,4030.5,4027.95,4026.59,4024.23,4021.61,4020.75,4016.99,4013.99,4014.6,4026.19,4040.83,4050.39,4056.34,4059.75,4056.34,4052.86,4051.51,4050.74,4048.01,4046.14,4042.86,4040.0,4037.18,4034.36,4031.97,4033.62,4045.93,4058.11,4067.88,4074.86,4077.1,4073.91,4070.15,4067.94,4065.01,4064.09,4061.79,4058.37,4055.31,4053.13,4049.9,4047.11,4049.09,4060.62,4071.23,4078.69,4082.51,4082.83,4079.06,4074.6,4073.44,4071.69,4068.81,4066.15,4062.94,4059.42,4057.23,4055.01,4052.94,4053.79,4064.14,4076.53,4081.2,4083.81,4084.23,4079.9,4076.82,4076.16,4075.31,4072.85,4070.27,4067.61,4064.62,4062.95,4060.41,4058.14,4058.43,4067.46,4077.87,4083.29,4087.57,4088.91,4085.66,4081.87,4078.51,4078.61,4076.93,4075.0,4071.69,4069.43,4066.45,4063.85,4061.83,4058.95,4059.08,4067.41,4075.56,4081.85,4085.64,4087.11,4083.94,4079.53,4076.96,4076.78,4075.25,4072.09,4068.93,4066.03,4062.5,4059.62,4056.99,4053.72,4050.5,4049.81,4056.79,4065.49,4069.79,4072.84,4072.0,4067.09,4062.51,4060.48,4060.49,4057.82,4056.48,4053.69,4051.07,4047.98,4046.49,4043.5,4040.27,4039.53,4046.15,4052.99,4055.62,4058.19,4057.45,4053.68,4050.17,4047.93,4046.71,4045.16,4042.42,4038.68,4035.46,4031.92,4029.28,4025.74,4022.54,4020.72,4026.15,4033.21,4037.98,4040.6,4040.13,4038.3,4033.06,4030.23,4028.51,4026.93,4024.61,4021.52,4019.02,4014.76,4010.67,4008.28,4005.05,4002.56,3998.89,3998.99,4006.42,4013.67,4016.59,4017.45,4017.82,4012.61,4009.2,4006.8,4005.72,4003.23,4001.61,3998.65,3995.29,3992.72,3989.5,3987.53,3985.76,3984.36,3990.09,3997.81,4001.73,4002.85,4001.63,3999.13,3996.2,3993.65,3991.97,3991.09,3988.38,3986.19,3983.51,3979.83,3977.88,3975.41,3972.99,3972.33,3980.34,3987.33,3990.85,3992.56,3992.84,3990.15,3986.8,3984.93,3983.52,3982.88,3981.32,3979.14,3976.11,3974.25,3971.19,3968.81,3965.83,3966.64,3973.73,3981.57,3984.99,3987.42,3987.46,3984.17,3980.47,3978.31,3976.39,3974.95,3970.74,3969.11,3966.64,3964.18,3960.89,3959.7,3956.63,3960.58,3970.39,3976.0,3978.8,3980.23,3978.17,3974.05,3973.31,3973.22,3972.34,3970.66,3968.8,3965.9,3964.46,3962.04,3959.06,3958.64,3966.94,3975.61,3980.13,3983.16,3983.36,3981.25,3979.2,3977.29,3977.08,3975.04,3973.83,3970.68,3968.31,3966.82,3963.63,3961.3,3963.51,3973.36,3982.74,3987.03,3991.45,3993.06,3991.01,3987.36,3985.47,3984.23,3981.81,3980.28,3978.28,3975.49,3973.8,3970.35,3969.16,3976.11,3985.33,3993.12,3997.28,3999.51,3997.91,3994.83,3992.49,3990.24,3989.93,3986.37,3983.41,3981.05,3978.45,3975.97,3973.7,3974.53,3985.73,3993.11,3998.3,4000.06,3998.86,3995.46,3993.05,3992.34,3991.28,3990.05,3987.94,3985.09,3982.05,3980.16,3978.09,3983.85,3993.35,4000.61,4005.77,4007.11,4004.39,4000.92,3998.68,3998.05,3996.07,3993.92,3990.39,3987.8,3985.39,3982.86,3981.37,3987.29,3997.57,4005.01,4010.19,4013.05,4012.45,4008.61,4005.72,4004.87,4003.02,3999.87,3997.11,3994.31,3990.39,3988.2,3985.57,3984.86,3993.75,4002.75,4009.61,4014.69,4015.49,4011.88,4006.92,4004.35,4003.67,4002.07,3998.95,3995.2,3992.83,3989.51,3987.26,3985.58,3991.21,4001.79,4010.14,4014.93,4015.85,4013.47,4008.97,4007.95,4006.53,4004.83,4002.06,3999.51,3995.25,3993.77,3990.87,3988.79,3995.2,4005.79,4013.0,4019.37,4022.19,4020.28,4015.72,4013.97,4010.97,4008.41,4007.22,4003.57,4000.9,3997.61,3994.77,3991.73,3997.0,4007.79,4017.01,4022.17,4025.01,4023.17,4019.66,4015.75,4013.73,4011.96,4009.44,4006.23,4002.45,3998.55,3994.53,3991.23,3992.63,4003.22,4013.39,4018.43,4021.51,4021.0,4016.31,4011.52,4009.31,4007.49,4006.7,4003.86,4001.73,4000.15,3994.84,3995.42,4002.66,4014.83,4021.81,4026.0,4027.79,4024.53,4021.12,4019.62,4017.85,4016.56,4013.66,4010.02,4007.45,4005.03,4002.09,4007.47,4019.26,4028.15,4035.39,4039.19,4037.92,4034.2,4031.26,4029.58,4027.18,4025.45,4023.83,4020.53,4016.99,4013.94,4016.62,4026.4,4036.43,4043.06,4047.63,4048.62,4042.97,4039.07,4036.32,4034.36,4032.05,4029.45,4025.84,4022.06,4018.57,4017.15,4025.83,4034.83,4041.52,4045.43,4045.89,4040.71,4036.57,4035.09,4034.09,4032.51,4030.14,4027.13,4024.61,4021.79,4021.93,4029.83,4039.56,4045.83,4049.75,4048.73,4043.27,4039.07,4037.75,4036.0,4033.09,4030.57,4026.97,4024.31,4020.74,4020.6,4028.39,4037.92,4045.99,4048.93,4050.56,4047.1,4042.28,4039.44,4037.48,4035.84,4032.64,4030.34,4026.09,4022.79,4021.67,4025.71,4034.14,4042.32,4046.61,4048.29,4045.48,4038.88,4034.38,4033.27,4031.68,4028.84,4025.67,4022.54,4019.28,4016.44,4022.08,4030.64,4036.97,4039.71,4040.28,4036.42,4031.89,4029.39,4027.78,4026.93,4024.44,4022.17,4018.94,4016.24,4015.63,4022.13,4029.4,4033.51,4036.36,4035.21,4030.33,4025.41,4023.8,4022.23,4019.36,4016.45,4014.33,4010.58,4008.09,4006.82,4012.52,4020.72,4025.09,4027.18,4027.1,4023.37,4017.99,4015.59,4013.76,4011.63,4009.51,4005.66,4001.23,3999.13,3996.07,3997.65,4006.71,4012.67,4016.52,4016.48,4012.92,4007.95,4004.12,4002.16,4000.23,3997.81,3995.96,3992.84,3990.66,3987.26,3987.92,3995.1,4001.04,4002.64,4002.54,3999.62,3995.04,3992.26,3991.01,3988.05,3986.31,3983.56,3980.86,3977.62,3974.73,3976.28,3983.97,3988.31,3989.96,3989.49,3986.59,3982.19,3978.42,3976.32,3974.41,3972.62,3969.78,3967.13,3964.32,3961.67,3962.09,3968.87,3973.09,3975.47,3975.53,3973.03,3968.83,3964.15,3961.99,3960.93,3958.48,3956.13,3952.86,3950.03,3946.82,3946.11,3952.23,3958.72,3960.52,3960.65,3958.21,3952.81,3948.99,3948.16,3947.06,3945.62,3943.88,3941.53,3939.55,3936.7,3935.63,3942.67,3948.04,3949.98,3951.87,3949.47,3945.15,3941.92,3940.73,3938.66,3936.4,3934.68,3932.02,3931.16,3927.6,3926.57,3933.16,3940.35,3943.75,3944.93,3943.22,3939.11,3932.81,3933.5,3931.83,3930.95,3929.26,3926.6,3923.91,3920.92,3920.12,3928.07,3934.85,3938.4,3939.65,3938.42,3933.91,3930.99,3929.32,3927.67,3926.15,3923.69,3922.08,3920.07,3917.39,3916.58,3924.12,3931.24,3935.48,3937.74,3935.69,3932.87,3930.44,3930.37,3930.08,3929.19,3927.72,3925.75,3924.06,3922.64,3926.11,3935.33,3940.73,3945.6,3946.46,3944.54,3941.67,3940.83,3940.24,3940.0,3938.76,3937.54,3933.88,3932.79};

//     double ppg_signal_2[] = {3707.82,3701.83,3695.83,3694.37,3690.72,3688.37,3684.58,3677.92,3671.88,3665.51,3660.7,3654.07,3652.88,3673.2,3700.97,3715.94,3724.07,3728.12,3725.51,3718.17,3712.5,3709.65,3708.29,3704.07,3697.01,3687.36,3683.2,3678.09,3670.35,3665.27,3665.2,3688.49,3714.05,3727.58,3732.29,3732.63,3726.22,3720.64,3720.09,3719.75,3719.19,3714.42,3709.7,3704.62,3701.49,3696.74,3688.62,3689.49,3708.69,3730.14,3743.56,3748.24,3750.3,3747.58,3739.27,3735.83,3735.25,3734.49,3732.79,3725.65,3719.61,3715.12,3708.34,3702.3,3697.64,3713.3,3739.13,3753.47,3762.08,3767.43,3763.49,3757.27,3752.9,3751.58,3749.81,3746.2,3743.48,3737.46,3734.13,3730.36,3721.52,3726.45,3746.4,3763.36,3773.16,3779.67,3778.99,3773.02,3766.98,3764.91,3764.08,3759.82,3756.3,3752.18,3748.82,3743.35,3737.62,3747.59,3766.81,3779.69,3786.92,3789.88,3787.37,3780.98,3774.9,3772.86,3769.8,3766.42,3761.15,3751.9,3746.68,3738.8,3734.13,3743.34,3766.24,3779.36,3784.38,3786.99,3782.12,3771.66,3765.56,3762.54,3760.7,3757.6,3753.24,3749.78,3747.75,3744.98,3742.02,3752.66,3773.24,3787.1,3793.57,3795.77,3792.88,3782.26,3780.53,3779.37,3776.84,3771.78,3765.85,3762.25,3755.98,3749.9,3745.24,3746.4,3769.1,3786.62,3797.11,3801.71,3802.95,3796.47,3791.05,3787.34,3783.61,3781.48,3776.91,3770.86,3765.64,3758.44,3751.4,3747.67,3756.67,3779.58,3793.41,3800.79,3805.91,3801.88,3794.17,3783.89,3781.66,3778.64,3773.7,3767.39,3760.26,3750.95,3745.82,3737.04,3729.35,3720.83,3731.28,3760.62,3777.61,3785.14,3786.23,3780.09,3773.25,3769.79,3768.35,3766.41,3760.43,3752.96,3747.81,3741.5,3735.52,3729.01,3724.34,3738.02,3761.07,3775.73,3781.5,3782.77,3779.36,3771.39,3764.64,3762.1,3757.5,3751.66,3745.38,3734.02,3728.62,3720.62,3713.83,3709.04,3724.74,3752.67,3769.79,3778.41,3782.63,3779.97,3770.01,3765.8,3763.03,3759.63,3754.26,3746.19,3737.33,3730.02,3721.09,3714.48,3703.62,3697.86,3707.86,3736.95,3757.59,3764.05,3766.23,3762.66,3752.03,3747.28,3744.7,3743.81,3743.04,3739.88,3735.73,3731.97,3728.17,3724.4,3719.75,3726.36,3752.63,3770.03,3778.71,3783.31,3780.03,3774.94,3769.17,3767.11,3764.7,3759.64,3754.07,3749.52,3744.94,3741.12,3735.07,3728.42,3733.25,3755.59,3776.39,3787.48,3792.33,3795.65,3790.53,3784.14,3781.22,3778.36,3776.08,3771.26,3765.62,3758.34,3750.61,3745.44,3737.28,3732.86,3737.19,3758.36,3778.39,3787.47,3792.45,3790.46,3779.63,3770.51,3766.4,3763.06,3758.25,3748.34,3738.7,3731.84,3728.88,3722.75,3719.34,3719.84,3741.72,3768.19,3779.62,3784.24,3783.77,3779.05,3772.66,3769.29,3766.77,3764.07,3759.56,3752.9,3746.02,3741.65,3735.77,3727.84,3723.82,3738.96,3763.36,3776.52,3783.71,3786.42,3782.95,3775.52,3769.54,3766.49,3764.87,3760.76,3751.62,3746.13,3739.94,3734.02,3728.48,3720.29,3714.2,3729.51,3753.77,3770.08,3776.74,3777.61,3774.14,3765.91,3760.57,3756.17,3751.02,3746.38,3737.99,3730.29,3719.79,3714.66,3706.04,3700.2,3692.57,3707.54,3736.57,3754.92,3761.59,3760.36,3753.16,3747.45,3745.7,3744.81,3742.38,3737.83,3733.66,3728.59,3723.82,3719.17,3713.02,3706.85,3711.64,3736.36,3758.75,3766.91,3771.8,3771.25,3765.84,3761.47,3758.93,3753.06,3749.64,3746.18,3740.93,3735.12,3729.29,3722.96,3717.09,3715.14,3734.28,3758.72,3772.76,3780.99,3783.4,3781.28,3775.25,3769.19,3766.49,3763.22,3757.99,3750.97,3745.14,3737.46,3730.84,3725.79,3717.92,3722.53,3745.31,3765.48,3775.68,3780.77,3780.28,3774.18,3769.52,3766.11,3765.35,3763.12,3761.08,3757.09,3752.76,3749.63,3746.76,3744.84,3752.33,3770.45,3785.22,3794.78,3800.45,3800.6,3794.41,3792.95,3791.12,3790.37,3787.84,3782.54,3778.67,3775.9,3772.72,3770.72,3768.4,3777.07,3796.5,3809.84,3820.54,3827.85,3825.88,3821.42,3818.43,3817.68,3815.6,3813.66,3810.65,3807.11,3802.2,3798.32,3795.75,3794.71,3804.1,3818.73,3831.01,3837.69,3842.42,3839.99,3832.08,3829.23,3828.46,3827.27,3824.93,3819.84,3814.76,3812.23,3809.46,3806.5,3803.99,3811.01,3827.21,3837.91,3843.86,3847.36,3843.14,3838.97,3836.91,3837.04,3836.08,3830.9,3827.71,3824.86,3821.53,3818.68,3814.43,3813.59,3821.24,3836.4,3846.15,3853.82,3856.05,3855.32,3849.42,3845.58,3844.06,3843.23,3841.75,3838.65,3833.96,3830.79,3829.01,3825.93,3823.1,3818.7,3825.27,3837.48,3847.04,3853.76,3857.77,3856.57,3849.61,3845.79,3845.25,3845.21,3841.1,3837.81,3833.73,3830.6,3828.08,3823.79,3819.3,3815.21,3813.21,3818.56,3831.65,3838.45,3842.37,3844.9,3842.37,3834.59,3828.72,3828.19,3828.69,3827.77,3824.14,3818.99,3815.64,3813.4,3812.46,3809.42,3804.96,3809.31,3820.99,3828.85,3833.48,3832.86,3830.82,3825.39,3819.91,3819.33,3817.71,3815.16,3812.34,3807.05,3802.07,3799.05,3796.4,3792.69,3787.9,3790.96,3801.97,3810.95,3816.79,3816.74,3815.64,3810.49,3805.77,3803.75,3803.09,3798.64,3796.43,3793.11,3787.71,3783.91,3778.57,3776.04,3772.35,3767.02,3765.29,3770.97,3784.2,3790.2,3794.26,3795.32,3790.47,3783.93,3779.99,3778.65,3776.85,3773.86,3768.85,3764.89,3762.15,3759.46,3756.48,3752.67,3751.11,3753.77,3764.58,3773.26,3775.89,3776.96,3775.1,3767.35,3763.73,3762.63,3760.51,3758.66,3754.04,3750.16,3746.79,3744.03,3740.52,3736.57,3732.99,3740.69,3752.63,3760.04,3762.66,3763.34,3761.34,3758.11,3754.84,3752.88,3749.41,3747.45,3745.47,3742.26,3737.53,3732.65,3729.59,3726.64,3723.15,3731.97,3741.9,3748.35,3752.91,3753.2,3749.74,3743.68,3739.46,3736.82,3735.66,3733.59,3729.13,3725.32,3719.7,3715.75,3710.49,3706.84,3707.77,3720.96,3731.31,3734.48,3735.24,3735.36,3731.44,3728.97,3726.46,3724.64,3723.14,3720.5,3718.15,3713.84,3711.07,3707.89,3704.34,3711.17,3724.18,3730.06,3735.62,3736.3,3734.44,3730.15,3726.49,3725.9,3724.06,3720.31,3718.01,3715.7,3711.48,3709.17,3705.02,3704.29,3713.55,3725.54,3734.21,3738.48,3741.89,3739.68,3734.42,3731.79,3730.34,3728.71,3726.89,3724.23,3720.08,3718.08,3712.49,3709.29,3711.29,3723.35,3733.05,3739.71,3741.9,3741.8,3737.11,3733.79,3731.28,3728.87,3727.19,3723.55,3720.07,3716.54,3712.03,3707.48,3706.04,3715.16,3726.81,3732.27,3736.01,3735.11,3733.79,3730.73,3729.27,3727.69,3726.09,3724.82,3721.99,3717.25,3715.29,3712.25,3713.51,3724.93,3734.99,3739.42,3744.11,3744.04,3739.91,3737.09,3733.3,3732.77,3730.1,3729.07,3724.62,3720.6,3717.57,3715.2,3714.53,3726.51,3737.29,3745.3,3749.33,3748.32,3745.7,3742.73,3741.63,3739.57,3736.26,3733.28,3730.13,3727.68,3722.76,3717.76,3715.58,3722.09,3733.78,3743.39,3748.29,3749.45,3748.18,3742.3,3738.4,3736.63,3733.8,3731.58,3728.87,3724.48,3720.6,3717.03,3712.99,3713.6,3726.89,3737.08,3744.63,3746.09,3746.36,3742.72,3740.43,3739.53,3736.08,3734.01,3731.0,3728.46,3724.36,3720.72,3717.01,3719.87,3731.18,3741.64,3747.81,3753.03,3752.95,3747.97,3745.38,3743.26,3742.32,3739.1,3735.01,3732.07,3728.47,3724.88,3720.87,3722.06,3731.01,3743.22,3751.0,3754.8,3757.48,3751.54,3747.34,3745.65,3745.27,3742.65,3737.17,3733.12,3730.18,3726.06,3721.46,3719.8,3726.95,3739.89,3747.86,3752.21,3753.96,3748.44,3744.45,3740.18,3738.46,3737.63,3733.69,3732.05,3729.54,3726.68,3723.51,3727.05,3739.48,3749.41,3755.52,3758.56,3758.64,3753.88,3751.56,3748.68,3747.49,3745.92,3743.4,3739.65,3735.26,3732.47,3734.06,3745.38,3756.95,3766.06,3770.89,3774.06,3770.83,3767.56,3765.92,3762.15,3760.87,3758.62,3755.86,3752.54,3748.05,3747.2,3756.01,3768.56,3777.39,3784.62,3787.41,3784.7,3779.67,3777.6,3775.69,3772.88,3769.25,3766.12,3763.01,3758.71,3755.08,3758.41,3770.89,3780.84,3786.58,3788.88,3785.52,3780.53,3775.9,3775.65,3773.99,3772.43,3769.99,3767.48,3763.18,3761.04,3766.82,3778.23,3787.84,3791.35,3795.14,3791.98,3787.32,3784.03,3781.42,3780.13,3778.1,3775.53,3772.22,3766.8,3765.12,3769.42,3780.91,3790.18,3797.56,3799.78,3799.15,3794.75,3791.09,3789.45,3785.26,3783.9,3780.61,3777.76,3773.89,3768.6,3769.24,3778.05,3788.18,3795.68,3800.57,3797.54,3793.33,3786.95,3785.55,3783.7,3781.8,3778.73,3772.34,3768.14,3764.8,3765.66,3775.87,3784.16,3789.42,3792.23,3791.16,3785.69,3781.31,3779.42,3780.04,3778.02,3775.96,3770.86,3768.52,3765.52,3770.43,3781.28,3788.26,3791.07,3793.26,3789.8,3783.65,3780.06,3777.83,3776.31,3773.48,3770.07,3767.95,3763.0,3760.59,3763.72,3774.12,3782.7,3787.17,3786.95,3784.92,3779.32,3776.22,3774.36,3771.75,3769.23,3766.14,3762.81,3759.6,3756.29,3753.92,3762.97,3772.18,3778.34,3780.08,3778.8,3772.19,3765.06,3763.13,3760.88,3758.94,3756.18,3751.04,3748.64,3745.47,3742.41,3749.69,3758.53,3763.88,3766.05,3765.14,3760.15,3754.08,3751.03,3750.1,3747.17,3744.24,3741.71,3736.16,3733.2,3733.0,3742.22,3751.21,3753.66,3756.07,3753.89,3749.12,3744.84,3739.78,3738.56,3736.4,3734.29,3732.68,3727.32,3723.46,3721.97,3730.01,3740.4,3744.39,3745.37,3745.95,3739.57,3731.64,3728.66,3727.5,3725.68,3721.82,3716.76,3714.12,3710.22,3706.66,3711.96,3723.52,3727.68,3729.96,3728.62,3723.08,3717.33,3713.17,3712.38,3711.63,3709.08,3705.61,3701.47,3699.27,3696.86,3702.12,3712.89,3719.73,3719.09,3718.79,3715.38,3709.63,3706.18,3702.68,3700.97,3699.09,3696.76,3694.06,3688.16,3684.46,3690.75,3702.46,3710.08,3712.81,3711.92,3708.13,3701.56,3698.31,3696.62,3696.4,3694.03,3688.01,3685.31,3682.1,3679.54,3685.01,3695.26,3702.12,3705.79,3704.8,3701.12,3695.74,3690.92,3688.85,3688.2,3685.57,3683.08,3678.62,3675.39,3670.89,3676.99,3690.45,3696.01,3698.51,3698.79,3695.34,3691.98,3688.56,3688.43,3687.46,3686.06,3684.39,3681.21,3678.82,3678.82,3689.84,3700.1,3704.51,3707.18,3705.98,3702.45,3699.91,3698.46,3695.49,3694.0,3693.27,3690.9,3687.59,3685.53};

//     int ppg_signal_length = sizeof(ppg_signal_1) / sizeof(ppg_signal_1[0]);
//     double ptt = find_ptt(ppg_signal_1, ppg_signal_2, ppg_signal_length);
//     printf("PTT called: %.2f seconds\n", ptt);
//     return 0;
// }
